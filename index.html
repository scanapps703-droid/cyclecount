<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Cycle Count - Hybrid Storage</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- SheetJS Library untuk Excel -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary: #ff2d20;
            --secondary: #47cdff;
            --dark: #1a1a1a;
            --light: #f8fafc;
            --gray: #e2e8f0;
            --text: #2c3e50;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
        }
        
        * {
            box-sizing: border-box;
            font-family: 'Nunito', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--light);
            margin: 0;
            padding: 0;
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        /* Logo Styles */
        .logo {
            display: inline-block;
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary) 0%, #ea4335 100%);
            border-radius: 50%;
            position: relative;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
        }
        
        .logo::before {
            content: "CC";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 800;
            font-size: 28px;
        }
        
        .logo.small {
            width: 40px;
            height: 40px;
            margin-right: 10px;
            margin-bottom: 0;
        }
        
        .logo.small::before {
            font-size: 16px;
        }
        
        /* Login Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, var(--primary) 0%, #ea4335 100%);
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            transition: transform 0.3s ease;
        }
        
        .login-card:hover {
            transform: translateY(-5px);
        }
        
        .login-logo {
            text-align: center;
            margin-bottom: 25px;
        }
        
        .login-logo h1 {
            color: var(--primary);
            font-weight: 800;
            font-size: 28px;
            margin: 0;
        }
        
        .login-logo p {
            color: #718096;
            margin-top: 5px;
        }
        
        /* Main App Styles */
        .app-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
        }
        
        .navbar {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 0.8rem 1rem;
            position: sticky;
            top: 0;
            z-index: 1030;
        }
        
        .navbar-brand {
            color: var(--primary);
            font-weight: 800;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
        }
        
        .sidebar {
            background-color: var(--dark);
            color: white;
            width: 250px;
            min-height: calc(100vh - 56px);
            position: fixed;
            top: 56px;
            left: 0;
            padding-top: 20px;
            transition: transform 0.3s ease;
            z-index: 1020;
            overflow-y: auto;
            height: calc(100vh - 56px);
        }
        
        .sidebar-menu {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .sidebar-menu li {
            margin-bottom: 5px;
        }
        
        .sidebar-menu a {
            color: #a0aec0;
            text-decoration: none;
            display: flex;
            align-items: center;
            padding: 12px 20px;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }
        
        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: #2d3748;
            color: white;
            border-left: 3px solid var(--primary);
        }
        
        .sidebar-menu i {
            width: 25px;
            text-align: center;
            margin-right: 10px;
        }
        
        .sidebar-submenu {
            list-style: none;
            padding: 0;
            margin: 0;
            padding-left: 40px;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .sidebar-submenu.expanded {
            max-height: 300px;
        }
        
        .sidebar-submenu li {
            margin-bottom: 2px;
        }
        
        .sidebar-submenu a {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        .has-submenu > a::after {
            content: "\f107";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            margin-left: auto;
            transition: transform 0.3s;
        }
        
        .has-submenu.expanded > a::after {
            transform: rotate(180deg);
        }
        
        .main-content {
            margin-left: 250px;
            padding: 30px;
            transition: all 0.3s;
            min-height: calc(100vh - 56px);
            background-color: var(--light);
        }
        
        .section-card {
            background-color: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
            padding: 25px;
            margin-bottom: 25px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .section-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.07);
        }
        
        .section-title {
            color: var(--text);
            font-weight: 700;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--gray);
            display: flex;
            align-items: center;
        }
        
        .section-title i {
            margin-right: 10px;
            color: var(--primary);
        }
        
        .btn-primary {
            background-color: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #e53e3e;
            border-color: #e53e3e;
            color: white;
        }
        
        .btn-outline-primary {
            color: var(--primary);
            border-color: var(--primary);
        }
        
        .btn-outline-primary:hover {
            background-color: var(--primary);
            color: white;
        }
        
        .form-control:focus, .form-select:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 0.2rem rgba(255, 45, 32, 0.25);
        }
        
        /* Notification Styles */
        .notification {
            background-color: #fed7d7;
            color: #c53030;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #f56565;
        }
        
        .count-saved {
            background-color: #c6f6d5;
            color: #2d7d32;
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
            border-left: 4px solid #38a169;
        }
        
        /* Toast Notification */
        .toast-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            background-color: white;
            color: var(--text);
            border-radius: 8px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-width: 300px;
            border-left: 4px solid var(--success);
            animation: fadeIn 0.5s, fadeOut 0.5s 2.5s forwards;
        }
        
        .toast.error {
            border-left: 4px solid var(--danger);
        }
        
        .toast.info {
            border-left: 4px solid var(--secondary);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        
        /* Table Styles */
        .table-responsive {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.04);
        }
        
        .table th {
            background-color: #f7fafc;
            font-weight: 600;
            color: #4a5568;
            white-space: nowrap;
            padding: 12px 15px;
        }
        
        .table td {
            padding: 12px 15px;
            vertical-align: middle;
        }
        
        /* Tabs */
        .nav-tabs {
            border-bottom: 2px solid var(--gray);
        }
        
        .nav-tabs .nav-link {
            color: #718096;
            font-weight: 600;
            border: none;
            padding: 12px 20px;
            transition: all 0.3s;
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary);
            border-bottom: 3px solid var(--primary);
            background: transparent;
        }
        
        /* Form Elements */
        .input-group-text {
            background-color: white;
        }
        
        .current-location-display {
            background-color: #e6f7ff;
            border-left: 4px solid var(--secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        /* GitHub Configuration */
        .github-config {
            background-color: #f6f8fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #e1e4e8;
        }
        
        .sync-status {
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        
        .sync-status.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .sync-status.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .sync-status.info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        
        /* Storage Status */
        .storage-status {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        
        .storage-status h5 {
            color: var(--primary);
            margin-bottom: 10px;
        }
        
        .storage-bar {
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 5px;
            overflow: hidden;
        }
        
        .storage-fill {
            height: 100%;
            border-radius: 5px;
            transition: width 0.3s ease;
        }
        
        .storage-indexeddb {
            background-color: var(--primary);
        }
        
        .storage-localstorage {
            background-color: var(--secondary);
        }
        
        .storage-info {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        /* Responsive Design */
        @media (max-width: 992px) {
            .sidebar {
                transform: translateX(-100%);
                width: 250px;
            }
            
            .sidebar.expanded {
                transform: translateX(0);
                box-shadow: 5px 0 15px rgba(0, 0, 0, 0.1);
            }
            
            .main-content {
                margin-left: 0;
            }
            
            .mobile-nav-backdrop {
                display: none;
                position: fixed;
                top: 56px;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 1010;
            }
            
            .mobile-nav-backdrop.expanded {
                display: block;
            }
        }
        
        @media (max-width: 768px) {
            .main-content {
                padding: 15px;
            }
            
            .section-card {
                padding: 20px;
            }
            
            .github-action-buttons .btn {
                min-width: 100%;
                margin-bottom: 10px;
            }
        }
        
        /* Utilities */
        .text-primary {
            color: var(--primary) !important;
        }
        
        .bg-primary {
            background-color: var(--primary) !important;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            border: 2px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Excel format info */
        .excel-format {
            background-color: #e8f4ff;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 14px;
        }
        
        .excel-format h5 {
            color: #1a73e8;
            margin-bottom: 10px;
        }
        
        .excel-format ul {
            margin-bottom: 0;
            padding-left: 20px;
        }
        
        /* Sync buttons */
        .sync-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .sync-buttons .btn {
            flex: 1;
        }
        
        .sync-info {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 10px;
        }
        
        /* Progress bar */
        .progress {
            height: 8px;
            margin-bottom: 15px;
            border-radius: 4px;
            overflow: hidden;
            background-color: #e9ecef;
        }
        
        .progress-bar {
            background-color: var(--primary);
            transition: width 0.3s ease;
        }
        
        /* Master Data Tabs */
        .master-data-tabs {
            margin-bottom: 20px;
        }
        
        /* Sync animation */
        .sync-animation {
            display: inline-block;
        }
        
        @keyframes syncSpin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .syncing {
            animation: syncSpin 1.5s linear infinite;
        }

        /* GitHub Status Indicator */
        .github-status {
            display: inline-flex;
            align-items: center;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            margin-left: 10px;
        }
        
        .github-status.connected {
            background-color: #d4edda;
            color: #155724;
        }
        
        .github-status.disconnected {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .github-status.checking {
            background-color: #fff3cd;
            color: #856404;
        }

        /* Upload Animation */
        .upload-progress {
            display: none;
            margin-top: 15px;
        }
        
        .upload-progress .progress-text {
            text-align: center;
            margin-top: 5px;
            font-size: 14px;
            color: #6c757d;
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="login-container" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <div class="logo"></div>
                <h1>CycleCount</h1>
                <p>Sistem Manajemen Stok</p>
            </div>
            <form id="login-form">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" class="form-control" id="username" required placeholder="Masukkan username">
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password" required placeholder="Masukkan password">
                </div>
                <div class="mb-3 form-check">
                    <input type="checkbox" class="form-check-input" id="remember">
                    <label class="form-check-label" for="remember">Ingat saya</label>
                </div>
                <button type="submit" class="btn btn-primary w-100 py-2">
                    <i class="fas fa-sign-in-alt me-2"></i> Login
                </button>
            </form>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app-container" class="app-container">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" id="sidebar-toggle">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="#">
                    <div class="logo small"></div>
                    CycleCount
                </a>
                <div class="d-flex align-items-center">
                    <span class="me-3 d-none d-md-block text-muted" id="user-welcome">Halo, User</span>
                    <span id="github-connection-status" class="github-status checking">
                        <i class="fas fa-circle-notch fa-spin me-1"></i> Checking GitHub
                    </span>
                    <button class="btn btn-outline-danger btn-sm ms-2" id="logout-btn">
                        <i class="fas fa-sign-out-alt me-1"></i> Logout
                    </button>
                </div>
            </div>
        </nav>

        <!-- Sidebar and Backdrop -->
        <div class="mobile-nav-backdrop" id="mobile-nav-backdrop"></div>
        <div class="sidebar" id="sidebar">
            <ul class="sidebar-menu">
                <li>
                    <a href="#form" class="active" data-tab="form">
                        <i class="fas fa-clipboard-list"></i>
                        <span class="menu-text">Form Cycle Count</span>
                    </a>
                </li>
                <li>
                    <a href="#data-count" data-tab="data-count">
                        <i class="fas fa-history"></i>
                        <span class="menu-text">Data Count</span>
                    </a>
                </li>
                <li class="has-submenu" id="master-data-menu">
                    <a href="#master-data" data-tab="master-data">
                        <i class="fas fa-database"></i>
                        <span class="menu-text">Master Data</span>
                    </a>
                    <ul class="sidebar-submenu">
                        <li>
                            <a href="#master-location" data-tab="master-location">
                                <i class="fas fa-map-marker-alt"></i>
                                <span class="menu-text">Master Lokasi</span>
                            </a>
                        </li>
                        <li>
                            <a href="#master-ean" data-tab="master-ean">
                                <i class="fas fa-barcode"></i>
                                <span class="menu-text">Master EAN</span>
                            </a>
                        </li>
                    </ul>
                </li>
                <li>
                    <a href="#inventory-balance" data-tab="inventory-balance">
                        <i class="fas fa-cubes"></i>
                        <span class="menu-text">Inventory Balance (IB)</span>
                    </a>
                </li>
                <li>
                    <a href="#github-config" data-tab="github-config">
                        <i class="fab fa-github"></i>
                        <span class="menu-text">Konfigurasi GitHub</span>
                    </a>
                </li>
                <li>
                    <a href="#storage-status" data-tab="storage-status">
                        <i class="fas fa-database"></i>
                        <span class="menu-text">Status Penyimpanan</span>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Main Content -->
        <div class="main-content" id="main-content">
            <!-- Form Cycle Count Tab -->
            <div class="tab-content active" id="form-tab">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-clipboard-list"></i> Form Cycle Count
                    </h2>
                    
                    <div class="notification" id="notification">
                        <i class="fas fa-exclamation-circle"></i> Data tidak ditemukan di inventory balanced. Pastikan lokasi dan EAN sudah terdaftar.
                    </div>
                    
                    <div class="count-saved" id="count-saved">
                        <i class="fas fa-info-circle"></i> Count untuk tipe ini sudah disimpan sebelumnya dan hanya dapat dilihat.
                    </div>
                    
                    <form id="cycleCountForm">
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="location" class="form-label">Lokasi</label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" id="location" name="location" required placeholder="Masukkan kode lokasi">
                                        <button type="button" class="btn btn-primary" id="save-location-btn">
                                            <i class="fas fa-save"></i> Simpan
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Current Location Display -->
                                <div class="current-location-display" id="current-location-display" style="display: none;">
                                    <h5>Lokasi Saat Ini: <span id="current-location-name" class="fw-bold text-primary"></span></h5>
                                    <p class="mb-0">Jumlah SKU: <span id="current-location-sku-count" class="fw-bold">0</span></p>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3 ean-input-container">
                                    <label for="ean" class="form-label">EAN</label>
                                    <input type="text" class="form-control" id="ean" name="ean" required placeholder="Scan atau masukkan kode EAN" autocomplete="off">
                                    <div class="ean-loading" id="ean-loading" style="position: absolute; right: 10px; top: 70%; transform: translateY(-50%); display: none;">
                                        <i class="fas fa-spinner fa-spin"></i>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="sku" class="form-label">SKU</label>
                                    <input type="text" class="form-control" id="sku" name="sku" readonly>
                                </div>
                                <div class="mb-3">
                                    <label for="description" class="form-label">Description</label>
                                    <input type="text" class="form-control" id="description" name="description" readonly>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row mb-4">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="traceId" class="form-label">Trace ID</label>
                                    <input type="text" class="form-control" id="traceId" name="traceId" readonly>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="countType" class="form-label">Count Type</label>
                                    <div class="row g-2">
                                        <div class="col-5">
                                            <select class="form-select" id="countType" name="countType">
                                                <option value="1stCount">1st Count</option>
                                                <option value="2ndCount">2nd Count</option>
                                                <option value="3rdCount">3rd Count</option>
                                            </select>
                                        </div>
                                        <div class="col-7">
                                            <input type="number" class="form-control" id="qty" name="qty" min="0" placeholder="Qty">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <label for="remark" class="form-label">Remark</label>
                            <textarea class="form-control" id="remark" name="remark" rows="3" placeholder="Keterangan tambahan (wajib diisi jika data tidak ada di inventory)"></textarea>
                        </div>

                        <!-- Auto-sync Toggle -->
                        <div class="auto-sync-toggle mb-4">
                            <div class="form-check form-switch">
                                <input class="form-check-input" type="checkbox" id="auto-sync-toggle" checked>
                                <label class="form-check-label" for="auto-sync-toggle">
                                    Auto-sync ke GitHub setelah menyimpan
                                </label>
                            </div>
                        </div>
                        
                        <div class="navigation-container card mb-4" id="navigation-container" style="display: none;">
                            <div class="card-body d-flex justify-content-center align-items-center">
                                <button type="button" class="btn btn-outline-primary me-3" id="prev-btn" disabled>
                                    <i class="fas fa-chevron-left"></i> Previous
                                </button>
                                <div class="nav-info mx-3 fw-bold" id="nav-info">Item 1 of 1</div>
                                <button type="button" class="btn btn-outline-primary ms-3" id="next-btn" disabled>
                                    Next <i class="fas fa-chevron-right"></i>
                                </button>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn btn-primary w-100 py-2">
                            <i class="fas fa-save me-2"></i> Simpan Data Count
                        </button>
                    </form>
                </div>
            </div>
            
            <!-- Data Count Tab -->
            <div class="tab-content" id="data-count-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-history"></i> Data Count History
                    </h2>
                    
                    <!-- GitHub Sync Buttons for Data Count -->
                    <div class="sync-buttons">
                        <button type="button" class="btn btn-primary" id="sync-cyclecount">
                            <i class="fas fa-sync-alt"></i> Sync Data Cycle Count
                        </button>
                    </div>
                    <div class="progress" id="sync-cyclecount-progress" style="display: none;">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="sync-info">
                        <i class="fas fa-info-circle"></i> Terakhir sinkronisasi: <span id="last-sync-cyclecount">Belum pernah</span>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-8">
                            <div class="d-flex flex-wrap align-items-center gap-2">
                                <label for="start-date" class="form-label mb-0">Dari:</label>
                                <input type="date" class="form-control me-3" id="start-date" style="width: auto;">
                                
                                <label for="end-date" class="form-label mb-0">Sampai:</label>
                                <input type="date" class="form-control me-3" id="end-date" style="width: auto;">
                                
                                <button class="btn btn-outline-primary" id="filter-btn">
                                    <i class="fas fa-filter"></i> Filter
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4 d-flex justify-content-end gap-2">
                            <button id="export-btn" class="btn btn-success">
                                <i class="fas fa-file-excel"></i> Export
                            </button>
                            <button id="delete-selected-btn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Hapus
                            </button>
                        </div>
                    </div>
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="data-count-table">
                            <thead>
                                <tr>
                                    <th scope="col" style="width: 50px;">
                                        <input type="checkbox" class="form-check-input" id="select-all">
                                    </th>
                                    <th scope="col">Tanggal</th>
                                    <th scope="col">Lokasi</th>
                                    <th scope="col">EAN</th>
                                    <th scope="col">SKU</th>
                                    <th scope="col">Count Type</th>
                                    <th scope="col">Qty</th>
                                    <th scope="col" style="width: 100px;">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Master Lokasi Tab -->
            <div class="tab-content" id="master-location-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-map-marker-alt"></i> Master Data Lokasi
                    </h2>
                    
                    <!-- GitHub Sync Buttons for Master Data Lokasi -->
                    <div class="sync-buttons">
                        <button type="button" class="btn btn-primary" id="sync-master-location">
                            <i class="fas fa-sync-alt"></i> Sync Data Master Lokasi
                        </button>
                    </div>
                    <div class="progress" id="sync-master-location-progress" style="display: none;">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="sync-info">
                        <i class="fas fa-info-circle"></i> Terakhir sinkronisasi: <span id="last-sync-master-location">Belum pernah</span>
                    </div>
                    
                    <div class="d-flex flex-wrap gap-2 mb-4">
                        <button id="upload-master-location-btn" class="btn btn-success">
                            <i class="fas fa-upload"></i> Upload Excel
                        </button>
                        <button id="download-master-location-btn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Excel
                        </button>
                        <button id="clear-master-location-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Hapus Semua
                        </button>
                        <button id="add-master-location-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Data
                        </button>
                    </div>

                    <!-- Upload Progress -->
                    <div class="upload-progress" id="upload-master-location-progress">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">Memproses data: <span id="upload-master-location-text">0%</span></div>
                    </div>

                    <!-- Excel Format Info -->
                    <div class="excel-format">
                        <h5><i class="fas fa-info-circle"></i> Format File Excel</h5>
                        <p>File Excel harus memiliki kolom dengan header berikut:</p>
                        <ul>
                            <li><strong>Validation Code</strong> (wajib)</li>
                            <li><strong>Location</strong> (wajib)</li>
                        </ul>
                    </div>
                    
                    <input type="file" id="master-location-file-input" accept=".xlsx, .xls" style="display: none;">
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="master-location-table">
                            <thead>
                                <tr>
                                    <th scope="col">Validation Code</th>
                                    <th scope="col">Location</th>
                                    <th scope="col" style="width: 100px;">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Master EAN Tab -->
            <div class="tab-content" id="master-ean-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-barcode"></i> Master Data EAN
                    </h2>
                    
                    <!-- GitHub Sync Buttons for Master Data EAN -->
                    <div class="sync-buttons">
                        <button type="button" class="btn btn-primary" id="sync-master-ean">
                            <i class="fas fa-sync-alt"></i> Sync Data Master EAN
                        </button>
                    </div>
                    <div class="progress" id="sync-master-ean-progress" style="display: none;">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="sync-info">
                        <i class="fas fa-info-circle"></i> Terakhir sinkronisasi: <span id="last-sync-master-ean">Belum pernah</span>
                    </div>
                    
                    <div class="d-flex flex-wrap gap-2 mb-4">
                        <button id="upload-master-ean-btn" class="btn btn-success">
                            <i class="fas fa-upload"></i> Upload Excel
                        </button>
                        <button id="download-master-ean-btn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Excel
                        </button>
                        <button id="clear-master-ean-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Hapus Semua
                        </button>
                        <button id="add-master-ean-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Data
                        </button>
                    </div>

                    <!-- Upload Progress -->
                    <div class="upload-progress" id="upload-master-ean-progress">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">Memproses data: <span id="upload-master-ean-text">0%</span></div>
                    </div>

                    <!-- Excel Format Info -->
                    <div class="excel-format">
                        <h5><i class="fas fa-info-circle"></i> Format File Excel</h5>
                        <p>File Excel harus memiliki kolom dengan header berikut:</p>
                        <ul>
                            <li><strong>EAN</strong> (wajib)</li>
                            <li><strong>SKU</strong> (wajib)</li>
                        </ul>
                    </div>
                    
                    <input type="file" id="master-ean-file-input" accept=".xlsx, .xls" style="display: none;">
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="master-ean-table">
                            <thead>
                                <tr>
                                    <th scope="col">EAN</th>
                                    <th scope="col">SKU</th>
                                    <th scope="col" style="width: 100px;">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- Inventory Balance Tab -->
            <div class="tab-content" id="inventory-balance-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-cubes"></i> Inventory Balance (IB) Management
                    </h2>
                    
                    <!-- GitHub Sync Buttons for Inventory Data -->
                    <div class="sync-buttons">
                        <button type="button" class="btn btn-primary" id="sync-inventory">
                            <i class="fas fa-sync-alt"></i> Sync Data Inventory
                        </button>
                    </div>
                    <div class="progress" id="sync-inventory-progress" style="display: none;">
                        <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                    </div>
                    <div class="sync-info">
                        <i class="fas fa-info-circle"></i> Terakhir sinkronisasi: <span id="last-sync-inventory">Belum pernah</span>
                    </div>
                    
                    <div class="d-flex flex-wrap gap-2 mb-4">
                        <button id="upload-inventory-btn" class="btn btn-success">
                            <i class="fas fa-upload"></i> Upload Excel
                        </button>
                        <button id="download-inventory-btn" class="btn btn-primary">
                            <i class="fas fa-download"></i> Download Excel
                        </button>
                        <button id="clear-inventory-btn" class="btn btn-danger">
                            <i class="fas fa-trash"></i> Hapus Semua
                        </button>
                        <button id="add-inventory-btn" class="btn btn-primary">
                            <i class="fas fa-plus"></i> Tambah Data
                        </button>
                    </div>

                    <!-- Upload Progress -->
                    <div class="upload-progress" id="upload-inventory-progress">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="progress-text">Memproses data: <span id="upload-inventory-text">0%</span></div>
                    </div>

                    <!-- Excel Format Info -->
                    <div class="excel-format">
                        <h5><i class="fas fa-info-circle"></i> Format File Excel</h5>
                        <p>File Excel harus memiliki kolom dengan header berikut:</p>
                        <ul>
                            <li><strong>Location ID</strong> (wajib)</li>
                            <li><strong>SKU</strong> (wajib)</li>
                            <li><strong>SKU Descr(L)</strong></li>
                            <li><strong>Trace ID</strong></li>
                            <li><strong>QTY On Hand</strong></li>
                        </ul>
                    </div>
                    
                    <input type="file" id="inventory-file-input" accept=".xlsx, .xls" style="display: none;">
                    
                    <div class="table-responsive">
                        <table class="table table-hover" id="inventory-table">
                            <thead>
                                <tr>
                                    <th scope="col">Location ID</th>
                                    <th scope="col">SKU</th>
                                    <th scope="col">SKU Descr(L)</th>
                                    <th scope="col">Trace ID</th>
                                    <th scope="col">QTY On Hand</th>
                                    <th scope="col" style="width: 100px;">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <!-- GitHub Configuration Tab -->
            <div class="tab-content" id="github-config-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fab fa-github"></i> Konfigurasi GitHub
                    </h2>
                    
                    <div class="github-config">
                        <h4><i class="fab fa-github"></i> Konfigurasi Penyimpanan GitHub</h4>
                        
                        <div class="mb-3">
                            <label for="github-token" class="form-label">GitHub Personal Access Token</label>
                            <input type="password" class="form-control" id="github-token" placeholder="Masukkan token akses GitHub">
                            <div class="form-text">
                                Token diperlukan untuk mengakses repository GitHub. 
                                <a href="https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token" target="_blank">Cara membuat token</a>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label for="github-owner" class="form-label">Pemilik Repository (Owner)</label>
                                <input type="text" class="form-control" id="github-owner" placeholder="Nama pengguna atau organisasi">
                            </div>
                            <div class="col-md-6">
                                <label for="github-repo" class="form-label">Nama Repository</label>
                                <input type="text" class="form-control" id="github-repo" placeholder="Nama repository">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="github-branch" class="form-label">Cabang (Branch)</label>
                            <input type="text" class="form-control" id="github-branch" value="main" placeholder="Nama cabang (default: main)">
                        </div>
                        
                        <div class="mb-3">
                            <label for="sync-interval" class="form-label">Interval Sinkronisasi Otomatis (menit)</label>
                            <input type="number" class="form-control" id="sync-interval" min="1" value="5" placeholder="Interval dalam menit">
                            <div class="form-text">
                                Setiap interval, data akan dikirim ke GitHub lalu ditarik dari GitHub
                            </div>
                        </div>
                        
                        <div class="form-check form-switch mb-3">
                            <input class="form-check-input" type="checkbox" id="auto-sync-enabled">
                            <label class="form-check-label" for="auto-sync-enabled">
                                Aktifkan Sinkronisasi Otomatis
                            </label>
                        </div>
                        
                        <button type="button" class="btn btn-primary" id="save-github-config">
                            <i class="fas fa-save"></i> Simpan Konfigurasi
                        </button>

                        <div class="mt-3" id="github-connection-test-result"></div>
                    </div>
                    
                    <div class="github-config">
                        <h4><i class="fas fa-info-circle"></i> Informasi</h4>
                        <p>Fitur ini memungkinkan Anda menyimpan data Cycle Count, Master Data, dan Inventory Balance ke repository GitHub.</p>
                        <ul>
                            <li>Data Cycle Count akan disimpan dalam file <code>cycle_count.json</code></li>
                            <li>Data Master Lokasi akan disimpan dalam file <code>master_location.json</code></li>
                            <li>Data Master EAN akan disimpan dalam file <code>master_ean.json</code></li>
                            <li>Data Inventory akan disimpan dalam file <code>inventory_data.json</code></li>
                            <li>Pastikan repository sudah dibuat sebelumnya di akun GitHub Anda</li>
                            <li>Token akses harus memiliki izin untuk membaca dan menulis ke repository</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- Storage Status Tab -->
            <div class="tab-content" id="storage-status-tab" style="display: none;">
                <div class="section-card">
                    <h2 class="section-title">
                        <i class="fas fa-database"></i> Status Penyimpanan Hybrid
                    </h2>
                    
                    <div class="storage-status">
                        <h5><i class="fas fa-info-circle"></i> Status Penyimpanan Data</h5>
                        <p>Sistem menggunakan penyimpanan hybrid yang mengoptimalkan performa dan kapasitas:</p>
                        
                        <div class="mb-3">
                            <div class="storage-bar">
                                <div class="storage-fill storage-indexeddb" id="indexeddb-usage" style="width: 0%"></div>
                            </div>
                            <div class="storage-info">
                                <span>IndexedDB (Penyimpanan Utama)</span>
                                <span id="indexeddb-stats">0 items</span>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="storage-bar">
                                <div class="storage-fill storage-localstorage" id="localstorage-usage" style="width: 0%"></div>
                            </div>
                            <div class="storage-info">
                                <span>LocalStorage (Fallback)</span>
                                <span id="localstorage-stats">0 items</span>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-primary me-2" id="refresh-storage-stats">
                                <i class="fas fa-sync-alt"></i> Refresh Status
                            </button>
                            <button class="btn btn-outline-danger" id="clear-all-data">
                                <i class="fas fa-trash"></i> Hapus Semua Data
                            </button>
                        </div>
                    </div>
                    
                    <div class="github-config mt-4">
                        <h5><i class="fas fa-cogs"></i> Pengaturan Penyimpanan</h5>
                        
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="enable-indexeddb" checked>
                            <label class="form-check-label" for="enable-indexeddb">
                                Aktifkan IndexedDB (Rekomendasi)
                            </label>
                        </div>
                        
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="enable-localstorage" checked>
                            <label class="form-check-label" for="enable-localstorage">
                                Aktifkan LocalStorage (Fallback)
                            </label>
                        </div>
                        
                        <div class="form-check form-switch mb-2">
                            <input class="form-check-input" type="checkbox" id="enable-github-sync" checked>
                            <label class="form-check-label" for="enable-github-sync">
                                Aktifkan Sinkronisasi GitHub (Backup)
                            </label>
                        </div>
                        
                        <button class="btn btn-outline-primary mt-2" id="save-storage-settings">
                            <i class="fas fa-save"></i> Simpan Pengaturan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification Container -->
    <div class="toast-container" id="toast-container"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // ==============================
        // HYBRID STORAGE MANAGER
        // ==============================
        
        class HybridStorageManager {
            constructor(userKey) {
                this.userKey = userKey;
                this.dbName = `CycleCountDB_${userKey}`;
                this.dbVersion = 2; // Increased version for new structure
                this.db = null;
                this.settings = {
                    enableIndexedDB: true,
                    enableLocalStorage: true,
                    enableGitHubSync: true
                };
                this.initPromise = this.initDB();
                this.loadSettings();
            }
            
            // Load settings from localStorage
            loadSettings() {
                const savedSettings = localStorage.getItem(`storageSettings_${this.userKey}`);
                if (savedSettings) {
                    this.settings = { ...this.settings, ...JSON.parse(savedSettings) };
                }
            }
            
            // Save settings to localStorage
            saveSettings() {
                localStorage.setItem(`storageSettings_${this.userKey}`, JSON.stringify(this.settings));
            }
            
            // Inisialisasi IndexedDB
            async initDB() {
                if (!this.settings.enableIndexedDB) {
                    console.log('IndexedDB disabled by settings');
                    return Promise.resolve(null);
                }
                
                return new Promise((resolve, reject) => {
                    if (!window.indexedDB) {
                        reject(new Error("Browser doesn't support IndexedDB"));
                        return;
                    }
                    
                    const request = indexedDB.open(this.dbName, this.dbVersion);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Buat object store untuk setiap tipe data
                        if (!db.objectStoreNames.contains('cycleCount')) {
                            const cycleCountStore = db.createObjectStore('cycleCount', { keyPath: 'id', autoIncrement: true });
                            cycleCountStore.createIndex('timestamp', 'timestamp', { unique: false });
                            cycleCountStore.createIndex('location', 'location', { unique: false });
                            cycleCountStore.createIndex('ean', 'ean', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('masterLocation')) {
                            const masterLocationStore = db.createObjectStore('masterLocation', { keyPath: 'validationCode' });
                            masterLocationStore.createIndex('location', 'location', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('masterEan')) {
                            const masterEanStore = db.createObjectStore('masterEan', { keyPath: 'ean' });
                            masterEanStore.createIndex('sku', 'sku', { unique: false });
                        }
                        
                        if (!db.objectStoreNames.contains('inventory')) {
                            const inventoryStore = db.createObjectStore('inventory', { keyPath: 'id', autoIncrement: true });
                            inventoryStore.createIndex('locationId', 'locationId', { unique: false });
                            inventoryStore.createIndex('sku', 'sku', { unique: false });
                            inventoryStore.createIndex('location_sku', ['locationId', 'sku'], { unique: true });
                        }
                    };
                    
                    request.onblocked = () => {
                        console.warn('Database upgrade blocked');
                    };
                });
            }
            
            // ==============================
            // METODE UNTUK CYCLE COUNT DATA
            // ==============================
            
            async saveCycleCount(data) {
                // Generate unique ID if not present
                if (!data.id) {
                    data.id = Date.now() + Math.random().toString(36).substr(2, 9);
                }
                
                data.timestamp = data.timestamp || new Date().toISOString();
                
                // Save to IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['cycleCount'], 'readwrite');
                        const store = tx.objectStore('cycleCount');
                        await store.put(data);
                    } catch (error) {
                        console.error('Error saving to IndexedDB:', error);
                    }
                }
                
                // Save to localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`cycleCountData_${this.userKey}`)) || [];
                        
                        // Check if item already exists
                        const existingIndex = localStorageData.findIndex(item => item.id === data.id);
                        if (existingIndex !== -1) {
                            localStorageData[existingIndex] = data;
                        } else {
                            localStorageData.push(data);
                        }
                        
                        localStorage.setItem(`cycleCountData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error saving to localStorage:', error);
                    }
                }
                
                return data;
            }
            
            async getCycleCount(startDate = null, endDate = null) {
                // Try IndexedDB first if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['cycleCount'], 'readonly');
                        const store = tx.objectStore('cycleCount');
                        const index = store.index('timestamp');
                        
                        let range = null;
                        if (startDate && endDate) {
                            range = IDBKeyRange.bound(
                                startDate.toISOString(),
                                endDate.toISOString()
                            );
                        }
                        
                        const data = await new Promise((resolve, reject) => {
                            const request = range ? index.getAll(range) : store.getAll();
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        // Sort by timestamp descending
                        data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        return data;
                    } catch (error) {
                        console.warn('IndexedDB error, fallback ke localStorage:', error);
                    }
                }
                
                // Fallback to localStorage
                if (this.settings.enableLocalStorage) {
                    try {
                        let data = JSON.parse(localStorage.getItem(`cycleCountData_${this.userKey}`)) || [];
                        
                        // Filter by date if needed
                        if (startDate && endDate) {
                            data = data.filter(item => {
                                const itemDate = new Date(item.timestamp);
                                return itemDate >= startDate && itemDate <= endDate;
                            });
                        }
                        
                        // Sort by timestamp descending
                        data.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
                        return data;
                    } catch (error) {
                        console.error('Error reading from localStorage:', error);
                    }
                }
                
                return [];
            }
            
            async deleteCycleCount(id) {
                // Delete from IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['cycleCount'], 'readwrite');
                        const store = tx.objectStore('cycleCount');
                        await store.delete(id);
                    } catch (error) {
                        console.error('Error deleting from IndexedDB:', error);
                    }
                }
                
                // Delete from localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`cycleCountData_${this.userKey}`)) || [];
                        localStorageData = localStorageData.filter(item => item.id !== id);
                        localStorage.setItem(`cycleCountData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error deleting from localStorage:', error);
                    }
                }
            }
            
            async deleteMultipleCycleCount(ids) {
                // Delete from IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['cycleCount'], 'readwrite');
                        const store = tx.objectStore('cycleCount');
                        
                        for (const id of ids) {
                            await store.delete(id);
                        }
                    } catch (error) {
                        console.error('Error deleting multiple from IndexedDB:', error);
                    }
                }
                
                // Delete from localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`cycleCountData_${this.userKey}`)) || [];
                        localStorageData = localStorageData.filter(item => !ids.includes(item.id));
                        localStorage.setItem(`cycleCountData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error deleting multiple from localStorage:', error);
                    }
                }
            }
            
            // ==============================
            // METODE UNTUK MASTER DATA
            // ==============================
            
            async saveMasterLocation(data) {
                // Ensure data is an array
                const dataArray = Array.isArray(data) ? data : [data];
                
                // Save to IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterLocation'], 'readwrite');
                        const store = tx.objectStore('masterLocation');
                        
                        for (const item of dataArray) {
                            await store.put(item);
                        }
                    } catch (error) {
                        console.error('Error saving master location to IndexedDB:', error);
                    }
                }
                
                // Save to localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        if (Array.isArray(data)) {
                            // Replace all data
                            localStorage.setItem(`masterLocationData_${this.userKey}`, JSON.stringify(data));
                        } else {
                            // Add or update single item
                            let localStorageData = JSON.parse(localStorage.getItem(`masterLocationData_${this.userKey}`)) || [];
                            const existingIndex = localStorageData.findIndex(item => item.validationCode === data.validationCode);
                            
                            if (existingIndex !== -1) {
                                localStorageData[existingIndex] = data;
                            } else {
                                localStorageData.push(data);
                            }
                            
                            localStorage.setItem(`masterLocationData_${this.userKey}`, JSON.stringify(localStorageData));
                        }
                    } catch (error) {
                        console.error('Error saving master location to localStorage:', error);
                    }
                }
                
                return dataArray;
            }
            
            async getMasterLocation() {
                // Try IndexedDB first if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterLocation'], 'readonly');
                        const store = tx.objectStore('masterLocation');
                        
                        const data = await new Promise((resolve, reject) => {
                            const request = store.getAll();
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        return data;
                    } catch (error) {
                        console.warn('IndexedDB error for master location, fallback ke localStorage:', error);
                    }
                }
                
                // Fallback to localStorage
                if (this.settings.enableLocalStorage) {
                    try {
                        return JSON.parse(localStorage.getItem(`masterLocationData_${this.userKey}`)) || [];
                    } catch (error) {
                        console.error('Error reading master location from localStorage:', error);
                    return [];
                    }
                }
                
                return [];
            }
            
            async deleteMasterLocation(validationCode) {
                // Delete from IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterLocation'], 'readwrite');
                        const store = tx.objectStore('masterLocation');
                        await store.delete(validationCode);
                    } catch (error) {
                        console.error('Error deleting master location from IndexedDB:', error);
                    }
                }
                
                // Delete from localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`masterLocationData_${this.userKey}`)) || [];
                        localStorageData = localStorageData.filter(item => item.validationCode !== validationCode);
                        localStorage.setItem(`masterLocationData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error deleting master location from localStorage:', error);
                    }
                }
            }
            
            // Similar methods for masterEan and inventory...
            // (Untuk menghemat ruang, saya akan singkatkan implementasinya)
            
            async saveMasterEan(data) {
                const dataArray = Array.isArray(data) ? data : [data];
                
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterEan'], 'readwrite');
                        const store = tx.objectStore('masterEan');
                        
                        for (const item of dataArray) {
                            await store.put(item);
                        }
                    } catch (error) {
                        console.error('Error saving master EAN to IndexedDB:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        if (Array.isArray(data)) {
                            localStorage.setItem(`masterEanData_${this.userKey}`, JSON.stringify(data));
                        } else {
                            let localStorageData = JSON.parse(localStorage.getItem(`masterEanData_${this.userKey}`)) || [];
                            const existingIndex = localStorageData.findIndex(item => item.ean === data.ean);
                            
                            if (existingIndex !== -1) {
                                localStorageData[existingIndex] = data;
                            } else {
                                localStorageData.push(data);
                            }
                            
                            localStorage.setItem(`masterEanData_${this.userKey}`, JSON.stringify(localStorageData));
                        }
                    } catch (error) {
                        console.error('Error saving master EAN to localStorage:', error);
                    }
                }
                
                return dataArray;
            }
            
            async getMasterEan() {
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterEan'], 'readonly');
                        const store = tx.objectStore('masterEan');
                        
                        const data = await new Promise((resolve, reject) => {
                            const request = store.getAll();
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        return data;
                    } catch (error) {
                        console.warn('IndexedDB error for master EAN, fallback ke localStorage:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        return JSON.parse(localStorage.getItem(`masterEanData_${this.userKey}`)) || [];
                    } catch (error) {
                        console.error('Error reading master EAN from localStorage:', error);
                        return [];
                    }
                }
                
                return [];
            }
            
            async deleteMasterEan(ean) {
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['masterEan'], 'readwrite');
                        const store = tx.objectStore('masterEan');
                        await store.delete(ean);
                    } catch (error) {
                        console.error('Error deleting master EAN from IndexedDB:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`masterEanData_${this.userKey}`)) || [];
                        localStorageData = localStorageData.filter(item => item.ean !== ean);
                        localStorage.setItem(`masterEanData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error deleting master EAN from localStorage:', error);
                    }
                }
            }
            
            // ==============================
            // METODE UNTUK INVENTORY DATA
            // ==============================
            
            async saveInventory(data) {
                const dataArray = Array.isArray(data) ? data : [data];
                
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['inventory'], 'readwrite');
                        const store = tx.objectStore('inventory');
                        
                        // Clear existing data if replacing all
                        if (Array.isArray(data)) {
                            await store.clear();
                        }
                        
                        for (const item of dataArray) {
                            // Generate ID if not present
                            if (!item.id) {
                                item.id = Date.now() + Math.random().toString(36).substr(2, 9);
                            }
                            await store.add(item);
                        }
                    } catch (error) {
                        console.error('Error saving inventory to IndexedDB:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        if (Array.isArray(data)) {
                            localStorage.setItem(`inventoryData_${this.userKey}`, JSON.stringify(data));
                        } else {
                            let localStorageData = JSON.parse(localStorage.getItem(`inventoryData_${this.userKey}`)) || [];
                            const existingIndex = localStorageData.findIndex(item => 
                                item.locationId === data.locationId && item.sku === data.sku
                            );
                            
                            if (existingIndex !== -1) {
                                localStorageData[existingIndex] = data;
                            } else {
                                localStorageData.push(data);
                            }
                            
                            localStorage.setItem(`inventoryData_${this.userKey}`, JSON.stringify(localStorageData));
                        }
                    } catch (error) {
                        console.error('Error saving inventory to localStorage:', error);
                    }
                }
                
                return dataArray;
            }
            
            async getInventory() {
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['inventory'], 'readonly');
                        const store = tx.objectStore('inventory');
                        
                        const data = await new Promise((resolve, reject) => {
                            const request = store.getAll();
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        return data;
                    } catch (error) {
                        console.warn('IndexedDB error for inventory, fallback ke localStorage:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        return JSON.parse(localStorage.getItem(`inventoryData_${this.userKey}`)) || [];
                    } catch (error) {
                        console.error('Error reading inventory from localStorage:', error);
                        return [];
                    }
                }
                
                return [];
            }
            
            async searchInventory(locationId, sku) {
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['inventory'], 'readonly');
                        const store = tx.objectStore('inventory');
                        const index = store.index('location_sku');
                        
                        const data = await new Promise((resolve, reject) => {
                            const request = index.getAll([locationId, sku]);
                            request.onsuccess = () => resolve(request.result);
                            request.onerror = () => reject(request.error);
                        });
                        
                        return data;
                    } catch (error) {
                        console.warn('IndexedDB error for inventory search, fallback ke localStorage:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        const allData = JSON.parse(localStorage.getItem(`inventoryData_${this.userKey}`)) || [];
                        return allData.filter(item => item.locationId === locationId && item.sku === sku);
                    } catch (error) {
                        console.error('Error searching inventory in localStorage:', error);
                        return [];
                    }
                }
                
                return [];
            }
            
            async deleteInventory(id) {
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const tx = this.db.transaction(['inventory'], 'readwrite');
                        const store = tx.objectStore('inventory');
                        await store.delete(id);
                    } catch (error) {
                        console.error('Error deleting inventory from IndexedDB:', error);
                    }
                }
                
                if (this.settings.enableLocalStorage) {
                    try {
                        let localStorageData = JSON.parse(localStorage.getItem(`inventoryData_${this.userKey}`)) || [];
                        localStorageData = localStorageData.filter(item => item.id !== id);
                        localStorage.setItem(`inventoryData_${this.userKey}`, JSON.stringify(localStorageData));
                    } catch (error) {
                        console.error('Error deleting inventory from localStorage:', error);
                    }
                }
            }
            
            // ==============================
            // METODE UNTUK SYNC DENGAN GITHUB
            // ==============================
            
            async exportAllData() {
                const cycleCount = await this.getCycleCount();
                const masterLocation = await this.getMasterLocation();
                const masterEan = await this.getMasterEan();
                const inventory = await this.getInventory();
                
                return {
                    cycleCount,
                    masterLocation,
                    masterEan,
                    inventory,
                    exportTimestamp: new Date().toISOString(),
                    version: '1.0'
                };
            }
            
            async importAllData(data) {
                if (data.cycleCount) {
                    for (const item of data.cycleCount) {
                        await this.saveCycleCount(item);
                    }
                }
                
                if (data.masterLocation) {
                    await this.saveMasterLocation(data.masterLocation);
                }
                
                if (data.masterEan) {
                    await this.saveMasterEan(data.masterEan);
                }
                
                if (data.inventory) {
                    await this.saveInventory(data.inventory);
                }
                
                return true;
            }
            
            // ==============================
            // METODE UNTUK STATISTIK
            // ==============================
            
            async getStorageStats() {
                const stats = {
                    cycleCount: { indexedDB: 0, localStorage: 0 },
                    masterLocation: { indexedDB: 0, localStorage: 0 },
                    masterEan: { indexedDB: 0, localStorage: 0 },
                    inventory: { indexedDB: 0, localStorage: 0 }
                };
                
                // Get IndexedDB stats if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const objectStores = [
                            { name: 'cycleCount', key: 'cycleCount' },
                            { name: 'masterLocation', key: 'masterLocation' },
                            { name: 'masterEan', key: 'masterEan' },
                            { name: 'inventory', key: 'inventory' }
                        ];
                        
                        for (const { name, key } of objectStores) {
                            const tx = this.db.transaction([name], 'readonly');
                            const store = tx.objectStore(name);
                            const count = await new Promise((resolve, reject) => {
                                const request = store.count();
                                request.onsuccess = () => resolve(request.result);
                                request.onerror = () => reject(request.error);
                            });
                            stats[key].indexedDB = count;
                        }
                    } catch (error) {
                        console.error('Error getting IndexedDB stats:', error);
                    }
                }
                
                // Get localStorage stats
                if (this.settings.enableLocalStorage) {
                    try {
                        const cycleCountData = JSON.parse(localStorage.getItem(`cycleCountData_${this.userKey}`)) || [];
                        stats.cycleCount.localStorage = cycleCountData.length;
                        
                        const masterLocationData = JSON.parse(localStorage.getItem(`masterLocationData_${this.userKey}`)) || [];
                        stats.masterLocation.localStorage = masterLocationData.length;
                        
                        const masterEanData = JSON.parse(localStorage.getItem(`masterEanData_${this.userKey}`)) || [];
                        stats.masterEan.localStorage = masterEanData.length;
                        
                        const inventoryData = JSON.parse(localStorage.getItem(`inventoryData_${this.userKey}`)) || [];
                        stats.inventory.localStorage = inventoryData.length;
                    } catch (error) {
                        console.error('Error getting localStorage stats:', error);
                    }
                }
                
                return stats;
            }
            
            // ==============================
            // METODE UNTUK CLEANUP
            // ==============================
            
            async clearAllData() {
                // Clear IndexedDB if enabled
                if (this.settings.enableIndexedDB && this.db) {
                    try {
                        const objectStores = ['cycleCount', 'masterLocation', 'masterEan', 'inventory'];
                        
                        for (const storeName of objectStores) {
                            const tx = this.db.transaction([storeName], 'readwrite');
                            const store = tx.objectStore(storeName);
                            await store.clear();
                        }
                    } catch (error) {
                        console.error('Error clearing IndexedDB:', error);
                    }
                }
                
                // Clear localStorage if enabled
                if (this.settings.enableLocalStorage) {
                    try {
                        localStorage.removeItem(`cycleCountData_${this.userKey}`);
                        localStorage.removeItem(`masterLocationData_${this.userKey}`);
                        localStorage.removeItem(`masterEanData_${this.userKey}`);
                        localStorage.removeItem(`inventoryData_${this.userKey}`);
                    } catch (error) {
                        console.error('Error clearing localStorage:', error);
                    }
                }
            }
            
            async clearStorage(storageType) {
                if (storageType === 'indexeddb' && this.settings.enableIndexedDB && this.db) {
                    try {
                        const objectStores = ['cycleCount', 'masterLocation', 'masterEan', 'inventory'];
                        
                        for (const storeName of objectStores) {
                            const tx = this.db.transaction([storeName], 'readwrite');
                            const store = tx.objectStore(storeName);
                            await store.clear();
                        }
                    } catch (error) {
                        console.error('Error clearing IndexedDB:', error);
                    }
                } else if (storageType === 'localstorage' && this.settings.enableLocalStorage) {
                    try {
                        localStorage.removeItem(`cycleCountData_${this.userKey}`);
                        localStorage.removeItem(`masterLocationData_${this.userKey}`);
                        localStorage.removeItem(`masterEanData_${this.userKey}`);
                        localStorage.removeItem(`inventoryData_${this.userKey}`);
                    } catch (error) {
                        console.error('Error clearing localStorage:', error);
                    }
                }
            }
        }

        // ==============================
        // INTEGRASI DENGAN APLIKASI UTAMA
        // ==============================
        
        // Variabel global untuk menyimpan state aplikasi
        let currentUser = null;
        let userKey = null;
        let storageManager = null;
        let autoSyncInterval = null;
        
        // Fungsi untuk menampilkan notifikasi toast
        function showToast(message, type = 'success') {
            const toastContainer = document.getElementById('toast-container');
            if (!toastContainer) return;
            
            const toast = document.createElement('div');
            toast.className = `toast ${type === 'error' ? 'error' : type === 'info' ? 'info' : ''}`;
            toast.innerHTML = `
                <div><i class="fas ${type === 'error' ? 'fa-exclamation-circle' : type === 'info' ? 'fa-info-circle' : 'fa-check-circle'} me-2"></i> ${message}</div>
                <button type="button" class="btn-close" onclick="this.parentElement.remove()"></button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Remove toast after 3 seconds
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, 3000);
        }
        
        // Fungsi untuk menguji koneksi GitHub
        async function testGithubConnection(config = null) {
            // Jika config tidak diberikan, maka membaca dari input
            if (config === null) {
                const githubTokenEl = document.getElementById('github-token');
                const githubOwnerEl = document.getElementById('github-owner');
                const githubRepoEl = document.getElementById('github-repo');
                
                if (!githubTokenEl || !githubOwnerEl || !githubRepoEl) {
                    // Elemen tidak ditemukan, mungkin tab belum aktif
                    console.error('Element konfigurasi GitHub tidak ditemukan');
                    return false;
                }
                
                config = {
                    token: githubTokenEl.value,
                    owner: githubOwnerEl.value,
                    repo: githubRepoEl.value
                };
            }
            
            const statusElement = document.getElementById('github-connection-status');
            const testResultElement = document.getElementById('github-connection-test-result');
            
            if (!config.token || !config.owner || !config.repo) {
                if (statusElement) {
                    statusElement.className = 'github-status disconnected';
                    statusElement.innerHTML = '<i class="fas fa-times-circle me-1"></i> GitHub: Tidak Terkonfigurasi';
                }
                if (testResultElement) {
                    testResultElement.innerHTML = '<div class="alert alert-warning mt-3">Konfigurasi GitHub belum lengkap</div>';
                }
                return false;
            }
            
            if (statusElement) {
                statusElement.className = 'github-status checking';
                statusElement.innerHTML = '<i class="fas fa-circle-notch fa-spin me-1"></i> GitHub: Mengecek...';
            }
            
            try {
                const url = `https://api.github.com/repos/${config.owner}/${config.repo}`;
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `token ${config.token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    if (statusElement) {
                        statusElement.className = 'github-status connected';
                        statusElement.innerHTML = '<i class="fas fa-check-circle me-1"></i> GitHub: Terhubung';
                    }
                    if (testResultElement) {
                        testResultElement.innerHTML = '<div class="alert alert-success mt-3">Koneksi GitHub berhasil!</div>';
                    }
                    return true;
                } else {
                    if (statusElement) {
                        statusElement.className = 'github-status disconnected';
                        statusElement.innerHTML = '<i class="fas fa-times-circle me-1"></i> GitHub: Gagal';
                    }
                    if (testResultElement) {
                        testResultElement.innerHTML = `<div class="alert alert-danger mt-3">Gagal terhubung ke GitHub: ${response.status} ${response.statusText}</div>`;
                    }
                    return false;
                }
            } catch (error) {
                console.error('Error testing GitHub connection:', error);
                if (statusElement) {
                    statusElement.className = 'github-status disconnected';
                    statusElement.innerHTML = '<i class="fas fa-times-circle me-1"></i> GitHub: Error';
                }
                if (testResultElement) {
                    testResultElement.innerHTML = `<div class="alert alert-danger mt-3">Error: ${error.message}</div>`;
                }
                return false;
            }
        }
        
        // Function to load GitHub configuration
        function loadGithubConfig() {
            const githubToken = document.getElementById('github-token');
            const githubOwner = document.getElementById('github-owner');
            const githubRepo = document.getElementById('github-repo');
            const githubBranch = document.getElementById('github-branch');
            const syncInterval = document.getElementById('sync-interval');
            const autoSyncEnabled = document.getElementById('auto-sync-enabled');
            const saveGithubConfigBtn = document.getElementById('save-github-config');
            
            if (!githubToken || !githubOwner || !githubRepo || !githubBranch || !syncInterval || !autoSyncEnabled || !saveGithubConfigBtn) return;
            
            const config = JSON.parse(localStorage.getItem(`githubConfig_${userKey}`)) || {};
            githubToken.value = config.token || '';
            githubOwner.value = config.owner || '';
            githubRepo.value = config.repo || '';
            githubBranch.value = config.branch || 'main';
            syncInterval.value = config.syncInterval || 5;
            autoSyncEnabled.checked = config.autoSyncEnabled || false;
            
            // Test connection when loading config
            testGithubConnection();
            
            // Start auto sync if enabled
            if (config.autoSyncEnabled) {
                startAutoSync(config.syncInterval || 5);
            }
            
            // Pasang event listener untuk save button
            saveGithubConfigBtn.addEventListener('click', function() {
                const config = {
                    token: githubToken.value,
                    owner: githubOwner.value,
                    repo: githubRepo.value,
                    branch: githubBranch.value,
                    syncInterval: parseInt(syncInterval.value) || 5,
                    autoSyncEnabled: autoSyncEnabled.checked
                };
                
                localStorage.setItem(`githubConfig_${userKey}`, JSON.stringify(config));
                showToast('Konfigurasi GitHub berhasil disimpan!');
                
                // Test connection after saving - dengan parameter config
                testGithubConnection(config);
                
                // Start auto sync if enabled
                if (autoSyncInterval) {
                    clearInterval(autoSyncInterval);
                    autoSyncInterval = null;
                }
                
                if (config.autoSyncEnabled) {
                    startAutoSync(config.syncInterval);
                }
            });
        }
        
        // Fungsi untuk render data count table
        async function renderDataCountTable() {
            const dataCountTable = document.getElementById('data-count-table') ? document.getElementById('data-count-table').querySelector('tbody') : null;
            const startDateFilter = document.getElementById('start-date');
            const endDateFilter = document.getElementById('end-date');
            
            if (!dataCountTable || !storageManager) return;
            
            const startDate = startDateFilter && startDateFilter.value ? new Date(startDateFilter.value) : new Date(0); // Mulai dari epoch
            const endDate = endDateFilter && endDateFilter.value ? new Date(endDateFilter.value) : new Date();
            endDate.setHours(23, 59, 59, 999); // Set to end of day
            
            try {
                const cycleCountData = await storageManager.getCycleCount(startDate, endDate);
                
                dataCountTable.innerHTML = '';
                
                if (cycleCountData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="8" class="text-center py-4 text-muted">Tidak ada data count</td>`;
                    dataCountTable.appendChild(row);
                    return;
                }
                
                cycleCountData.forEach((item) => {
                    const row = document.createElement('tr');
                    const date = new Date(item.timestamp);
                    const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                    
                    row.innerHTML = `
                        <td>
                            <input type="checkbox" class="form-check-input data-checkbox" data-id="${item.id}">
                        </td>
                        <td>${formattedDate}</td>
                        <td>${item.location}</td>
                        <td>${item.ean}</td>
                        <td>${item.sku}</td>
                        <td>${item.countType}</td>
                        <td>${item.qty}</td>
                        <td>
                            <button class="btn btn-sm btn-danger delete-data-btn" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    dataCountTable.appendChild(row);
                });
                
                // Add event listeners to checkboxes
                document.querySelectorAll('.data-checkbox').forEach(checkbox => {
                    checkbox.addEventListener('change', updateSelectAllCheckbox);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-data-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const id = this.getAttribute('data-id');
                        await deleteDataCountItem(id);
                    });
                });
            } catch (error) {
                console.error('Error rendering data count table:', error);
                showToast('Error memuat data count: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk render master location data
        async function renderMasterLocationData() {
            const masterLocationTable = document.getElementById('master-location-table') ? document.getElementById('master-location-table').querySelector('tbody') : null;
            
            if (!masterLocationTable || !storageManager) return;
            
            try {
                const masterLocationData = await storageManager.getMasterLocation();
                
                masterLocationTable.innerHTML = '';
                
                if (masterLocationData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="3" class="text-center py-4 text-muted">Tidak ada data master lokasi</td>`;
                    masterLocationTable.appendChild(row);
                    return;
                }
                
                masterLocationData.forEach((item) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.validationCode || ''}</td>
                        <td>${item.location || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-danger delete-master-location-btn" data-validationcode="${item.validationCode}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    masterLocationTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-master-location-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const validationCode = this.getAttribute('data-validationcode');
                        await deleteMasterLocationItem(validationCode);
                    });
                });
            } catch (error) {
                console.error('Error rendering master location data:', error);
                showToast('Error memuat data master lokasi: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk render master EAN data
        async function renderMasterEanData() {
            const masterEanTable = document.getElementById('master-ean-table') ? document.getElementById('master-ean-table').querySelector('tbody') : null;
            
            if (!masterEanTable || !storageManager) return;
            
            try {
                const masterEanData = await storageManager.getMasterEan();
                
                masterEanTable.innerHTML = '';
                
                if (masterEanData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="3" class="text-center py-4 text-muted">Tidak ada data master EAN</td>`;
                    masterEanTable.appendChild(row);
                    return;
                }
                
                masterEanData.forEach((item) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.ean || ''}</td>
                        <td>${item.sku || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-danger delete-master-ean-btn" data-ean="${item.ean}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    masterEanTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-master-ean-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const ean = this.getAttribute('data-ean');
                        await deleteMasterEanItem(ean);
                    });
                });
            } catch (error) {
                console.error('Error rendering master EAN data:', error);
                showToast('Error memuat data master EAN: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk render inventory data
        async function renderInventoryData() {
            const inventoryTable = document.getElementById('inventory-table') ? document.getElementById('inventory-table').querySelector('tbody') : null;
            
            if (!inventoryTable || !storageManager) return;
            
            try {
                const inventoryData = await storageManager.getInventory();
                
                inventoryTable.innerHTML = '';
                
                if (inventoryData.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = `<td colspan="6" class="text-center py-4 text-muted">Tidak ada data inventory</td>`;
                    inventoryTable.appendChild(row);
                    return;
                }
                
                inventoryData.forEach((item) => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${item.locationId || ''}</td>
                        <td>${item.sku || ''}</td>
                        <td>${item.skuDescrL || ''}</td>
                        <td>${item.traceId || ''}</td>
                        <td>${item.qtyOnHand || ''}</td>
                        <td>
                            <button class="btn btn-sm btn-danger delete-inventory-btn" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </td>
                    `;
                    inventoryTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                document.querySelectorAll('.delete-inventory-btn').forEach(btn => {
                    btn.addEventListener('click', async function() {
                        const id = this.getAttribute('data-id');
                        await deleteInventoryItem(id);
                    });
                });
            } catch (error) {
                console.error('Error rendering inventory data:', error);
                showToast('Error memuat data inventory: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk menghapus data count item
        async function deleteDataCountItem(id) {
            if (!confirm('Apakah Anda yakin ingin menghapus data ini?')) {
                return;
            }
            
            try {
                await storageManager.deleteCycleCount(id);
                await renderDataCountTable();
                showToast('Data berhasil dihapus');
            } catch (error) {
                console.error('Error deleting data count item:', error);
                showToast('Error menghapus data: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk menghapus master location item
        async function deleteMasterLocationItem(validationCode) {
            if (confirm('Apakah Anda yakin ingin menghapus data master lokasi ini?')) {
                try {
                    await storageManager.deleteMasterLocation(validationCode);
                    await renderMasterLocationData();
                    showToast('Data master lokasi berhasil dihapus!');
                } catch (error) {
                    console.error('Error deleting master location item:', error);
                    showToast('Error menghapus data master lokasi: ' + error.message, 'error');
                }
            }
        }
        
        // Fungsi untuk menghapus master EAN item
        async function deleteMasterEanItem(ean) {
            if (confirm('Apakah Anda yakin ingin menghapus data master EAN ini?')) {
                try {
                    await storageManager.deleteMasterEan(ean);
                    await renderMasterEanData();
                    showToast('Data master EAN berhasil dihapus!');
                } catch (error) {
                    console.error('Error deleting master EAN item:', error);
                    showToast('Error menghapus data master EAN: ' + error.message, 'error');
                }
            }
        }
        
        // Fungsi untuk menghapus inventory item
        async function deleteInventoryItem(id) {
            if (confirm('Apakah Anda yakin ingin menghapus data inventory ini?')) {
                try {
                    await storageManager.deleteInventory(id);
                    await renderInventoryData();
                    showToast('Data inventory berhasil dihapus!');
                } catch (error) {
                    console.error('Error deleting inventory item:', error);
                    showToast('Error menghapus data inventory: ' + error.message, 'error');
                }
            }
        }
        
        // Fungsi untuk update select all checkbox
        function updateSelectAllCheckbox() {
            const allCheckboxes = document.querySelectorAll('.data-checkbox');
            const checkedCheckboxes = document.querySelectorAll('.data-checkbox:checked');
            const selectAllCheckbox = document.getElementById('select-all');
            
            if (selectAllCheckbox) {
                selectAllCheckbox.checked = allCheckboxes.length > 0 && allCheckboxes.length === checkedCheckboxes.length;
            }
        }
        
        // Start auto sync
        function startAutoSync(intervalMinutes) {
            if (autoSyncInterval) {
                clearInterval(autoSyncInterval);
            }
            
            autoSyncInterval = setInterval(() => {
                showToast('Memulai sinkronisasi otomatis...', 'info');
                autoSyncToGitHub();
            }, intervalMinutes * 60 * 1000);
        }
        
        // Function to auto-sync data to GitHub
        async function autoSyncToGitHub() {
            // Check if auto-sync is enabled
            const config = JSON.parse(localStorage.getItem(`githubConfig_${userKey}`)) || {};
            if (!config.autoSyncEnabled || !storageManager.settings.enableGitHubSync) {
                return;
            }
            
            if (!config.token || !config.owner || !config.repo) {
                return;
            }
            
            showToast('Memulai sinkronisasi otomatis...', 'info');
            
            try {
                // Export all data
                const allData = await storageManager.exportAllData();
                
                // Sync to GitHub
                await syncDataWithGithub('cycle_count', allData.cycleCount);
                await syncDataWithGithub('master_location', allData.masterLocation);
                await syncDataWithGithub('master_ean', allData.masterEan);
                await syncDataWithGithub('inventory_data', allData.inventory);
                
                showToast('Sinkronisasi otomatis berhasil!');
            } catch (error) {
                console.error('Error during auto-sync:', error);
                showToast('Error selama sinkronisasi otomatis: ' + error.message, 'error');
            }
        }
        
        // Fungsi untuk sync data dengan GitHub
        async function syncDataWithGithub(dataType, data) {
            // Implementation for syncing with GitHub
            // This would involve making API calls to GitHub to update files
            // For brevity, I'll leave this as a placeholder
            console.log(`Syncing ${dataType} with GitHub`, data);
            
            // Simulate API call
            return new Promise((resolve) => {
                setTimeout(() => {
                    resolve(true);
                }, 1000);
            });
        }
        
        // Fungsi untuk menampilkan status penyimpanan
        async function renderStorageStatus() {
            if (!storageManager) return;
            
            try {
                const stats = await storageManager.getStorageStats();
                
                // Calculate totals
                const indexedDBTotal = stats.cycleCount.indexedDB + stats.masterLocation.indexedDB + 
                                      stats.masterEan.indexedDB + stats.inventory.indexedDB;
                
                const localStorageTotal = stats.cycleCount.localStorage + stats.masterLocation.localStorage + 
                                         stats.masterEan.localStorage + stats.inventory.localStorage;
                
                const totalItems = indexedDBTotal + localStorageTotal;
                
                // Update progress bars
                const indexedDBUsage = document.getElementById('indexeddb-usage');
                const localStorageUsage = document.getElementById('localstorage-usage');
                
                if (indexedDBUsage) {
                    const percentage = totalItems > 0 ? (indexedDBTotal / totalItems) * 100 : 0;
                    indexedDBUsage.style.width = `${percentage}%`;
                }
                
                if (localStorageUsage) {
                    const percentage = totalItems > 0 ? (localStorageTotal / totalItems) * 100 : 0;
                    localStorageUsage.style.width = `${percentage}%`;
                }
                
                // Update stats text
                const indexedDBStats = document.getElementById('indexeddb-stats');
                const localStorageStats = document.getElementById('localstorage-stats');
                
                if (indexedDBStats) {
                    indexedDBStats.textContent = `${indexedDBTotal} items`;
                }
                
                if (localStorageStats) {
                    localStorageStats.textContent = `${localStorageTotal} items`;
                }
                
                // Update settings checkboxes
                const enableIndexedDB = document.getElementById('enable-indexeddb');
                const enableLocalStorage = document.getElementById('enable-localstorage');
                const enableGitHubSync = document.getElementById('enable-github-sync');
                
                if (enableIndexedDB) {
                    enableIndexedDB.checked = storageManager.settings.enableIndexedDB;
                }
                
                if (enableLocalStorage) {
                    enableLocalStorage.checked = storageManager.settings.enableLocalStorage;
                }
                
                if (enableGitHubSync) {
                    enableGitHubSync.checked = storageManager.settings.enableGitHubSync;
                }
            } catch (error) {
                console.error('Error rendering storage status:', error);
            }
        }
        
        document.addEventListener('DOMContentLoaded', function() {
            // ==============================
// IMPLEMENTASI FUNGSI UPLOAD, DOWNLOAD, HAPUS, TAMBAH DATA
// ==============================

// Fungsi untuk upload data Master Location dari Excel
function setupMasterLocationUpload() {
    const uploadBtn = document.getElementById('upload-master-location-btn');
    const fileInput = document.getElementById('master-location-file-input');
    const progressContainer = document.getElementById('upload-master-location-progress');
    const progressBar = progressContainer.querySelector('.progress-bar');
    const progressText = document.getElementById('upload-master-location-text');

    if (!uploadBtn || !fileInput) return;

    uploadBtn.addEventListener('click', function() {
        fileInput.click();
    });

    fileInput.addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.name.match(/\.(xlsx|xls)$/)) {
            showToast('Harap pilih file Excel (.xlsx atau .xls)', 'error');
            return;
        }

        try {
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = '0%';

            const data = await readExcelFile(file, progressBar, progressText);
            
            // Validasi data
            if (!Array.isArray(data) || data.length === 0) {
                throw new Error('Data Excel tidak valid atau kosong');
            }

            // Validasi kolom required
            const requiredColumns = ['Validation Code', 'Location'];
            const firstRow = data[0];
            const hasRequiredColumns = requiredColumns.every(col => firstRow.hasOwnProperty(col));
            
            if (!hasRequiredColumns) {
                throw new Error(`File Excel harus memiliki kolom: ${requiredColumns.join(', ')}`);
            }

            // Transform data
            const transformedData = data.map(row => ({
                validationCode: row['Validation Code'],
                location: row['Location']
            }));

            // Simpan data
            await storageManager.saveMasterLocation(transformedData);
            
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
            
            showToast(`Berhasil mengupload ${transformedData.length} data master lokasi`);
            await renderMasterLocationData();
            
            // Reset file input
            fileInput.value = '';
            
            // Sembunyikan progress bar setelah beberapa detik
            setTimeout(() => {
                progressContainer.style.display = 'none';
            }, 2000);
            
        } catch (error) {
            console.error('Error uploading master location:', error);
            showToast('Error mengupload data: ' + error.message, 'error');
            progressContainer.style.display = 'none';
        }
    });
}

// Fungsi untuk download data Master Location ke Excel
function setupMasterLocationDownload() {
    const downloadBtn = document.getElementById('download-master-location-btn');
    
    if (!downloadBtn) return;
    
    downloadBtn.addEventListener('click', async function() {
        try {
            const data = await storageManager.getMasterLocation();
            
            if (data.length === 0) {
                showToast('Tidak ada data master lokasi untuk didownload', 'info');
                return;
            }
            
            // Transform data untuk Excel
            const excelData = data.map(item => ({
                'Validation Code': item.validationCode,
                'Location': item.location
            }));
            
            // Buat worksheet
            const ws = XLSX.utils.json_to_sheet(excelData);
            
            // Buat workbook
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Master Location');
            
            // Download file
            XLSX.writeFile(wb, `master_location_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast(`Berhasil mendownload ${data.length} data master lokasi`);
        } catch (error) {
            console.error('Error downloading master location:', error);
            showToast('Error mendownload data: ' + error.message, 'error');
        }
    });
}

// Fungsi untuk hapus semua data Master Location
function setupMasterLocationClear() {
    const clearBtn = document.getElementById('clear-master-location-btn');
    
    if (!clearBtn) return;
    
    clearBtn.addEventListener('click', async function() {
        if (!confirm('Apakah Anda yakin ingin menghapus SEMUA data master lokasi? Tindakan ini tidak dapat dibatalkan!')) {
            return;
        }
        
        try {
            // Hapus dari IndexedDB
            if (storageManager.settings.enableIndexedDB && storageManager.db) {
                const tx = storageManager.db.transaction(['masterLocation'], 'readwrite');
                const store = tx.objectStore('masterLocation');
                await store.clear();
            }
            
            // Hapus dari localStorage
            if (storageManager.settings.enableLocalStorage) {
                localStorage.removeItem(`masterLocationData_${userKey}`);
            }
            
            await renderMasterLocationData();
            showToast('Semua data master lokasi berhasil dihapus');
        } catch (error) {
            console.error('Error clearing master location:', error);
            showToast('Error menghapus data: ' + error.message, 'error');
        }
    });
}

// Fungsi untuk tambah data Master Location
function setupMasterLocationAdd() {
    const addBtn = document.getElementById('add-master-location-btn');
    const saveBtn = document.getElementById('saveMasterLocationBtn');
    const modal = new bootstrap.Modal(document.getElementById('addMasterLocationModal'));
    
    if (!addBtn || !saveBtn) return;
    
    addBtn.addEventListener('click', function() {
        document.getElementById('addMasterLocationForm').reset();
        modal.show();
    });
    
    saveBtn.addEventListener('click', async function() {
        const validationCode = document.getElementById('addValidationCode').value.trim();
        const location = document.getElementById('addLocation').value.trim();
        
        if (!validationCode || !location) {
            showToast('Harap isi semua field yang diperlukan', 'error');
            return;
        }
        
        try {
            const newData = {
                validationCode: validationCode,
                location: location
            };
            
            await storageManager.saveMasterLocation(newData);
            await renderMasterLocationData();
            modal.hide();
            showToast('Data master lokasi berhasil ditambahkan');
        } catch (error) {
            console.error('Error adding master location:', error);
            showToast('Error menambahkan data: ' + error.message, 'error');
        }
    });
}

// Fungsi untuk membaca file Excel
function readExcelFile(file, progressBar, progressText) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        
        reader.onload = function(e) {
            try {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                
                // Ambil sheet pertama
                const firstSheetName = workbook.SheetNames[0];
                const worksheet = workbook.Sheets[firstSheetName];
                
                // Konversi ke JSON
                const jsonData = XLSX.utils.sheet_to_json(worksheet);
                
                // Update progress
                if (progressBar && progressText) {
                    progressBar.style.width = '100%';
                    progressText.textContent = '100%';
                }
                
                resolve(jsonData);
            } catch (error) {
                reject(error);
            }
        };
        
        reader.onerror = function() {
            reject(new Error('Gagal membaca file'));
        };
        
        // Simulasi progress (karena FileReader tidak memiliki progress event untuk XLSX)
        let progress = 0;
        const progressInterval = setInterval(() => {
            if (progress < 90) {
                progress += 10;
                if (progressBar && progressText) {
                    progressBar.style.width = `${progress}%`;
                    progressText.textContent = `${progress}%`;
                }
            }
        }, 100);
        
        reader.onloadend = function() {
            clearInterval(progressInterval);
        };
        
        reader.readAsArrayBuffer(file);
    });
}

// Setup serupa untuk Master EAN
function setupMasterEanUpload() {
    const uploadBtn = document.getElementById('upload-master-ean-btn');
    const fileInput = document.getElementById('master-ean-file-input');
    const progressContainer = document.getElementById('upload-master-ean-progress');
    const progressBar = progressContainer.querySelector('.progress-bar');
    const progressText = document.getElementById('upload-master-ean-text');

    if (!uploadBtn || !fileInput) return;

    uploadBtn.addEventListener('click', function() {
        fileInput.click();
    });

    fileInput.addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.name.match(/\.(xlsx|xls)$/)) {
            showToast('Harap pilih file Excel (.xlsx atau .xls)', 'error');
            return;
        }

        try {
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = '0%';

            const data = await readExcelFile(file, progressBar, progressText);
            
            if (!Array.isArray(data) || data.length === 0) {
                throw new Error('Data Excel tidak valid atau kosong');
            }

            const requiredColumns = ['EAN', 'SKU'];
            const firstRow = data[0];
            const hasRequiredColumns = requiredColumns.every(col => firstRow.hasOwnProperty(col));
            
            if (!hasRequiredColumns) {
                throw new Error(`File Excel harus memiliki kolom: ${requiredColumns.join(', ')}`);
            }

            const transformedData = data.map(row => ({
                ean: row['EAN'],
                sku: row['SKU']
            }));

            await storageManager.saveMasterEan(transformedData);
            
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
            
            showToast(`Berhasil mengupload ${transformedData.length} data master EAN`);
            await renderMasterEanData();
            
            fileInput.value = '';
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
            }, 2000);
            
        } catch (error) {
            console.error('Error uploading master EAN:', error);
            showToast('Error mengupload data: ' + error.message, 'error');
            progressContainer.style.display = 'none';
        }
    });
}

function setupMasterEanDownload() {
    const downloadBtn = document.getElementById('download-master-ean-btn');
    
    if (!downloadBtn) return;
    
    downloadBtn.addEventListener('click', async function() {
        try {
            const data = await storageManager.getMasterEan();
            
            if (data.length === 0) {
                showToast('Tidak ada data master EAN untuk didownload', 'info');
                return;
            }
            
            const excelData = data.map(item => ({
                'EAN': item.ean,
                'SKU': item.sku
            }));
            
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Master EAN');
            
            XLSX.writeFile(wb, `master_ean_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast(`Berhasil mendownload ${data.length} data master EAN`);
        } catch (error) {
            console.error('Error downloading master EAN:', error);
            showToast('Error mendownload data: ' + error.message, 'error');
        }
    });
}

function setupMasterEanClear() {
    const clearBtn = document.getElementById('clear-master-ean-btn');
    
    if (!clearBtn) return;
    
    clearBtn.addEventListener('click', async function() {
        if (!confirm('Apakah Anda yakin ingin menghapus SEMUA data master EAN? Tindakan ini tidak dapat dibatalkan!')) {
            return;
        }
        
        try {
            if (storageManager.settings.enableIndexedDB && storageManager.db) {
                const tx = storageManager.db.transaction(['masterEan'], 'readwrite');
                const store = tx.objectStore('masterEan');
                await store.clear();
            }
            
            if (storageManager.settings.enableLocalStorage) {
                localStorage.removeItem(`masterEanData_${userKey}`);
            }
            
            await renderMasterEanData();
            showToast('Semua data master EAN berhasil dihapus');
        } catch (error) {
            console.error('Error clearing master EAN:', error);
            showToast('Error menghapus data: ' + error.message, 'error');
        }
    });
}

function setupMasterEanAdd() {
    const addBtn = document.getElementById('add-master-ean-btn');
    const saveBtn = document.getElementById('saveMasterEanBtn');
    const modal = new bootstrap.Modal(document.getElementById('addMasterEanModal'));
    
    if (!addBtn || !saveBtn) return;
    
    addBtn.addEventListener('click', function() {
        document.getElementById('addMasterEanForm').reset();
        modal.show();
    });
    
    saveBtn.addEventListener('click', async function() {
        const ean = document.getElementById('addEan').value.trim();
        const sku = document.getElementById('addSku').value.trim();
        
        if (!ean || !sku) {
            showToast('Harap isi semua field yang diperlukan', 'error');
            return;
        }
        
        try {
            const newData = {
                ean: ean,
                sku: sku
            };
            
            await storageManager.saveMasterEan(newData);
            await renderMasterEanData();
            modal.hide();
            showToast('Data master EAN berhasil ditambahkan');
        } catch (error) {
            console.error('Error adding master EAN:', error);
            showToast('Error menambahkan data: ' + error.message, 'error');
        }
    });
}

// Setup serupa untuk Inventory
function setupInventoryUpload() {
    const uploadBtn = document.getElementById('upload-inventory-btn');
    const fileInput = document.getElementById('inventory-file-input');
    const progressContainer = document.getElementById('upload-inventory-progress');
    const progressBar = progressContainer.querySelector('.progress-bar');
    const progressText = document.getElementById('upload-inventory-text');

    if (!uploadBtn || !fileInput) return;

    uploadBtn.addEventListener('click', function() {
        fileInput.click();
    });

    fileInput.addEventListener('change', async function(e) {
        const file = e.target.files[0];
        if (!file) return;

        if (!file.name.match(/\.(xlsx|xls)$/)) {
            showToast('Harap pilih file Excel (.xlsx atau .xls)', 'error');
            return;
        }

        try {
            progressContainer.style.display = 'block';
            progressBar.style.width = '0%';
            progressText.textContent = '0%';

            const data = await readExcelFile(file, progressBar, progressText);
            
            if (!Array.isArray(data) || data.length === 0) {
                throw new Error('Data Excel tidak valid atau kosong');
            }

            const requiredColumns = ['Location ID', 'SKU'];
            const firstRow = data[0];
            const hasRequiredColumns = requiredColumns.every(col => firstRow.hasOwnProperty(col));
            
            if (!hasRequiredColumns) {
                throw new Error(`File Excel harus memiliki kolom: ${requiredColumns.join(', ')}`);
            }

            const transformedData = data.map(row => ({
                locationId: row['Location ID'],
                sku: row['SKU'],
                skuDescrL: row['SKU Descr(L)'] || '',
                traceId: row['Trace ID'] || '',
                qtyOnHand: row['QTY On Hand'] || 0
            }));

            await storageManager.saveInventory(transformedData);
            
            progressBar.style.width = '100%';
            progressText.textContent = '100%';
            
            showToast(`Berhasil mengupload ${transformedData.length} data inventory`);
            await renderInventoryData();
            
            fileInput.value = '';
            
            setTimeout(() => {
                progressContainer.style.display = 'none';
            }, 2000);
            
        } catch (error) {
            console.error('Error uploading inventory:', error);
            showToast('Error mengupload data: ' + error.message, 'error');
            progressContainer.style.display = 'none';
        }
    });
}

function setupInventoryDownload() {
    const downloadBtn = document.getElementById('download-inventory-btn');
    
    if (!downloadBtn) return;
    
    downloadBtn.addEventListener('click', async function() {
        try {
            const data = await storageManager.getInventory();
            
            if (data.length === 0) {
                showToast('Tidak ada data inventory untuk didownload', 'info');
                return;
            }
            
            const excelData = data.map(item => ({
                'Location ID': item.locationId,
                'SKU': item.sku,
                'SKU Descr(L)': item.skuDescrL,
                'Trace ID': item.traceId,
                'QTY On Hand': item.qtyOnHand
            }));
            
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Inventory');
            
            XLSX.writeFile(wb, `inventory_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast(`Berhasil mendownload ${data.length} data inventory`);
        } catch (error) {
            console.error('Error downloading inventory:', error);
            showToast('Error mendownload data: ' + error.message, 'error');
        }
    });
}

function setupInventoryClear() {
    const clearBtn = document.getElementById('clear-inventory-btn');
    
    if (!clearBtn) return;
    
    clearBtn.addEventListener('click', async function() {
        if (!confirm('Apakah Anda yakin ingin menghapus SEMUA data inventory? Tindakan ini tidak dapat dibatalkan!')) {
            return;
        }
        
        try {
            if (storageManager.settings.enableIndexedDB && storageManager.db) {
                const tx = storageManager.db.transaction(['inventory'], 'readwrite');
                const store = tx.objectStore('inventory');
                await store.clear();
            }
            
            if (storageManager.settings.enableLocalStorage) {
                localStorage.removeItem(`inventoryData_${userKey}`);
            }
            
            await renderInventoryData();
            showToast('Semua data inventory berhasil dihapus');
        } catch (error) {
            console.error('Error clearing inventory:', error);
            showToast('Error menghapus data: ' + error.message, 'error');
        }
    });
}

function setupInventoryAdd() {
    const addBtn = document.getElementById('add-inventory-btn');
    const saveBtn = document.getElementById('saveInventoryBtn');
    const modal = new bootstrap.Modal(document.getElementById('addInventoryModal'));
    
    if (!addBtn || !saveBtn) return;
    
    addBtn.addEventListener('click', function() {
        document.getElementById('addInventoryForm').reset();
        modal.show();
    });
    
    saveBtn.addEventListener('click', async function() {
        const locationId = document.getElementById('addLocationId').value.trim();
        const sku = document.getElementById('addSkuInventory').value.trim();
        const skuDescrL = document.getElementById('addSkuDescrL').value.trim();
        const traceId = document.getElementById('addTraceId').value.trim();
        const qtyOnHand = document.getElementById('addQtyOnHand').value.trim();
        
        if (!locationId || !sku) {
            showToast('Harap isi Location ID dan SKU', 'error');
            return;
        }
        
        try {
            const newData = {
                locationId: locationId,
                sku: sku,
                skuDescrL: skuDescrL,
                traceId: traceId,
                qtyOnHand: qtyOnHand ? parseInt(qtyOnHand) : 0
            };
            
            await storageManager.saveInventory(newData);
            await renderInventoryData();
            modal.hide();
            showToast('Data inventory berhasil ditambahkan');
        } catch (error) {
            console.error('Error adding inventory:', error);
            showToast('Error menambahkan data: ' + error.message, 'error');
        }
    });
}

// Panggil setup functions dalam initApp
async function initApp() {
    try {
        // ... kode yang sudah ada ...
        
        // Setup fungsi upload, download, hapus, tambah untuk semua tab
        setupMasterLocationUpload();
        setupMasterLocationDownload();
        setupMasterLocationClear();
        setupMasterLocationAdd();
        
        setupMasterEanUpload();
        setupMasterEanDownload();
        setupMasterEanClear();
        setupMasterEanAdd();
        
        setupInventoryUpload();
        setupInventoryDownload();
        setupInventoryClear();
        setupInventoryAdd();
        
        // ... kode yang sudah ada ...
        
    } catch (error) {
        console.error('Error in initApp:', error);
        showToast('Terjadi kesalahan dalam inisialisasi aplikasi: ' + error.message, 'error');
    }
}
            // Fungsi untuk hapus data count terpilih
function setupDeleteSelectedDataCount() {
    const deleteSelectedBtn = document.getElementById('delete-selected-btn');
    
    if (!deleteSelectedBtn) return;
    
    deleteSelectedBtn.addEventListener('click', async function() {
        const selectedCheckboxes = document.querySelectorAll('.data-checkbox:checked');
        
        if (selectedCheckboxes.length === 0) {
            showToast('Tidak ada data yang dipilih untuk dihapus', 'info');
            return;
        }
        
        if (!confirm(`Apakah Anda yakin ingin menghapus ${selectedCheckboxes.length} data terpilih?`)) {
            return;
        }
        
        try {
            const idsToDelete = Array.from(selectedCheckboxes).map(checkbox => 
                checkbox.getAttribute('data-id')
            );
            
            await storageManager.deleteMultipleCycleCount(idsToDelete);
            await renderDataCountTable();
            showToast(`${idsToDelete.length} data berhasil dihapus`);
        } catch (error) {
            console.error('Error deleting selected data count:', error);
            showToast('Error menghapus data: ' + error.message, 'error');
        }
    });
}

// Panggil dalam initApp
setupDeleteSelectedDataCount();
            // Fungsi untuk export data count ke Excel
function setupExportDataCount() {
    const exportBtn = document.getElementById('export-btn');
    
    if (!exportBtn) return;
    
    exportBtn.addEventListener('click', async function() {
        try {
            const startDateFilter = document.getElementById('start-date');
            const endDateFilter = document.getElementById('end-date');
            
            const startDate = startDateFilter && startDateFilter.value ? new Date(startDateFilter.value) : new Date(0);
            const endDate = endDateFilter && endDateFilter.value ? new Date(endDateFilter.value) : new Date();
            endDate.setHours(23, 59, 59, 999);
            
            const data = await storageManager.getCycleCount(startDate, endDate);
            
            if (data.length === 0) {
                showToast('Tidak ada data untuk diexport', 'info');
                return;
            }
            
            const excelData = data.map(item => {
                const date = new Date(item.timestamp);
                const formattedDate = `${date.getDate().toString().padStart(2, '0')}/${(date.getMonth() + 1).toString().padStart(2, '0')}/${date.getFullYear()} ${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`;
                
                return {
                    'Tanggal': formattedDate,
                    'Lokasi': item.location,
                    'EAN': item.ean,
                    'SKU': item.sku,
                    'Count Type': item.countType,
                    'Qty': item.qty,
                    'Remark': item.remark || ''
                };
            });
            
            const ws = XLSX.utils.json_to_sheet(excelData);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Cycle Count Data');
            
            XLSX.writeFile(wb, `cycle_count_data_${new Date().toISOString().split('T')[0]}.xlsx`);
            
            showToast(`Berhasil mengexport ${data.length} data cycle count`);
        } catch (error) {
            console.error('Error exporting data count:', error);
            showToast('Error mengexport data: ' + error.message, 'error');
        }
    });
}

// Panggil dalam initApp
setupExportDataCount();
            // Login functionality
            const loginContainer = document.getElementById('login-container');
            const appContainer = document.getElementById('app-container');
            const loginForm = document.getElementById('login-form');
            const logoutBtn = document.getElementById('logout-btn');
            const userWelcome = document.getElementById('user-welcome');
            const sidebarToggle = document.getElementById('sidebar-toggle');
            const sidebar = document.getElementById('sidebar');
            const mobileNavBackdrop = document.getElementById('mobile-nav-backdrop');
            const masterDataMenu = document.getElementById('master-data-menu');
            
            // Check if user is already logged in
            const savedUser = sessionStorage.getItem('currentUser');
            if (savedUser) {
                try {
                    showApp(savedUser);
                } catch (error) {
                    console.error('Error showing app:', error);
                    sessionStorage.removeItem('currentUser');
                    showLogin();
                }
            }
            
            // Login form submission
            loginForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value;
                
                // Simple validation - in a real app, you would verify credentials with a server
                if (username && password) {
                    sessionStorage.setItem('currentUser', username);
                    try {
                        await showApp(username);
                    } catch (error) {
                        console.error('Error showing app:', error);
                        sessionStorage.removeItem('currentUser');
                        showToast('Terjadi kesalahan saat login. Silakan coba lagi.', 'error');
                    }
                } else {
                    showToast('Harap isi username dan password', 'error');
                }
            });
            
            // Logout functionality
            logoutBtn.addEventListener('click', function() {
                // Clear auto sync interval
                if (autoSyncInterval) {
                    clearInterval(autoSyncInterval);
                    autoSyncInterval = null;
                }
                
                sessionStorage.removeItem('currentUser');
                showLogin();
            });
            
            // Toggle sidebar on mobile
            if (sidebarToggle && sidebar && mobileNavBackdrop) {
                sidebarToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('expanded');
                    mobileNavBackdrop.classList.toggle('expanded');
                });
                
                // Close sidebar when clicking on backdrop
                mobileNavBackdrop.addEventListener('click', function() {
                    sidebar.classList.remove('expanded');
                    mobileNavBackdrop.classList.remove('expanded');
                });
            }
            
            // Master data menu toggle
            if (masterDataMenu) {
                masterDataMenu.addEventListener('click', function(e) {
                    if (e.target.tagName === 'A' && e.target.getAttribute('data-tab') === 'master-data') {
                        e.preventDefault();
                        this.classList.toggle('expanded');
                        const submenu = this.querySelector('.sidebar-submenu');
                        if (submenu) {
                            submenu.classList.toggle('expanded');
                        }
                    }
                });
            }
            
            // Auto hide sidebar on scroll
            let scrollTimer;
            window.addEventListener('scroll', function() {
                if (window.innerWidth < 992) {
                    if (sidebar.classList.contains('expanded')) {
                        clearTimeout(scrollTimer);
                        scrollTimer = setTimeout(function() {
                            sidebar.classList.remove('expanded');
                            mobileNavBackdrop.classList.remove('expanded');
                        }, 250);
                    }
                }
            });
            
            // Function to show the app
            async function showApp(username) {
                try {
                    currentUser = username;
                    userKey = username;
                    loginContainer.style.display = 'none';
                    appContainer.style.display = 'flex';
                    if (userWelcome) {
                        userWelcome.textContent = `Halo, ${username}`;
                    }
                    
                    // Initialize the storage manager
                    storageManager = new HybridStorageManager(userKey);
                    await storageManager.initPromise;
                    
                    // Initialize the app with user-specific data
                    await initApp();
                    
                    // Test GitHub connection
                    setTimeout(testGithubConnection, 1000);
                } catch (error) {
                    console.error('Error in showApp:', error);
                    throw error;
                }
            }
            
            // Function to show login
            function showLogin() {
                currentUser = null;
                userKey = null;
                storageManager = null;
                if (loginContainer) loginContainer.style.display = 'flex';
                if (appContainer) appContainer.style.display = 'none';
            }
            
            // Sidebar navigation
            const sidebarLinks = document.querySelectorAll('.sidebar-menu a');
            const tabContents = document.querySelectorAll('.tab-content');
            
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab link
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    // If this is a submenu item, also activate the parent
                    if (this.closest('.sidebar-submenu')) {
                        const parentItem = this.closest('.has-submenu');
                        if (parentItem) {
                            const parentLink = parentItem.querySelector('a');
                            if (parentLink) {
                                parentLink.classList.add('active');
                            }
                        }
                    }
                    
                    // Show active tab content
                    tabContents.forEach(content => content.style.display = 'none');
                    const activeTab = document.getElementById(`${tabId}-tab`);
                    if (activeTab) {
                        activeTab.style.display = 'block';
                    }
                    
                    // Close sidebar on mobile after selection
                    if (window.innerWidth < 992) {
                        if (sidebar) sidebar.classList.remove('expanded');
                        if (mobileNavBackdrop) mobileNavBackdrop.classList.remove('expanded');
                    }
                    
                    // If data count tab is selected, render the data
                    if (tabId === 'data-count') {
                        renderDataCountTable();
                    } else if (tabId === 'master-location') {
                        renderMasterLocationData();
                    } else if (tabId === 'master-ean') {
                        renderMasterEanData();
                    } else if (tabId === 'inventory-balance') {
                        renderInventoryData();
                    } else if (tabId === 'github-config') {
                        loadGithubConfig();
                    } else if (tabId === 'storage-status') {
                        renderStorageStatus();
                    }
                });
            });
            
            // Initialize app with user-specific data
            async function initApp() {
                try {
                    // Form elements
                    const form = document.getElementById('cycleCountForm');
                    const locationField = document.getElementById('location');
                    const eanField = document.getElementById('ean');
                    const eanLoading = document.getElementById('ean-loading');
                    const skuField = document.getElementById('sku');
                    const descriptionField = document.getElementById('description');
                    const traceIdField = document.getElementById('traceId');
                    const countTypeField = document.getElementById('countType');
                    const qtyField = document.getElementById('qty');
                    const remarkField = document.getElementById('remark');
                    const notification = document.getElementById('notification');
                    const countSavedNotification = document.getElementById('count-saved');
                    const saveLocationBtn = document.getElementById('save-location-btn');
                    const currentLocationDisplay = document.getElementById('current-location-display');
                    const currentLocationName = document.getElementById('current-location-name');
                    const currentLocationSkuCount = document.getElementById('current-location-sku-count');
                    const autoSyncToggle = document.getElementById('auto-sync-toggle');
                    
                    // Navigation elements
                    const navigationContainer = document.getElementById('navigation-container');
                    const prevBtn = document.getElementById('prev-btn');
                    const nextBtn = document.getElementById('next-btn');
                    const navInfo = document.getElementById('nav-info');
                    
                    // Storage status elements
                    const refreshStorageStatsBtn = document.getElementById('refresh-storage-stats');
                    const clearAllDataBtn = document.getElementById('clear-all-data');
                    const saveStorageSettingsBtn = document.getElementById('save-storage-settings');
                    
                    // Set default dates for filter
                    const today = new Date();
                    const oneWeekAgo = new Date();
                    oneWeekAgo.setDate(today.getDate() - 7);
                    
                    const startDateFilter = document.getElementById('start-date');
                    const endDateFilter = document.getElementById('end-date');
                    
                    if (startDateFilter && endDateFilter) {
                        startDateFilter.value = oneWeekAgo.toISOString().split('T')[0];
                        endDateFilter.value = today.toISOString().split('T')[0];
                    }
                    
                    // Variables for navigation
                    let currentLocationItems = [];
                    let currentItemIndex = 0;
                    let eanInputTimeout;
                    
                    // Load last sync info
                    function loadLastSyncInfo() {
                        // Implementation similar to before
                    }
                    
                    // Load auto-sync preference
                    if (autoSyncToggle) {
                        const autoSyncEnabled = localStorage.getItem(`autoSyncEnabled_${userKey}`);
                        if (autoSyncEnabled !== null) {
                            autoSyncToggle.checked = autoSyncEnabled === 'true';
                        }
                        
                        // Save auto-sync preference when changed
                        autoSyncToggle.addEventListener('change', function() {
                            localStorage.setItem(`autoSyncEnabled_${userKey}`, this.checked);
                        });
                    }
                    
                    // Function to display current location SKU count
                    async function renderCurrentLocationSKUCount(location) {
                        if (!currentLocationDisplay || !currentLocationName || !currentLocationSkuCount) return;
                        
                        if (!location) {
                            currentLocationDisplay.style.display = 'none';
                            return;
                        }
                        
                        try {
                            // Calculate SKU count for the current location from inventory data
                            const inventoryData = await storageManager.getInventory();
                            const skuSet = new Set();
                            
                            inventoryData.forEach(item => {
                                if (item.locationId === location) {
                                    skuSet.add(item.sku);
                                }
                            });
                            
                            const skuCount = skuSet.size;
                            
                            // Update display
                            currentLocationName.textContent = location;
                            currentLocationSkuCount.textContent = skuCount;
                            currentLocationDisplay.style.display = 'block';
                        } catch (error) {
                            console.error('Error rendering current location SKU count:', error);
                        }
                    }
                    
                    // Save location and load related data
                    if (saveLocationBtn && locationField) {
                        saveLocationBtn.addEventListener('click', function() {
                            const location = locationField.value.trim();
                            if (!location) {
                                showToast('Harap masukkan kode lokasi!', 'error');
                                return;
                            }
                            
                            // Update current location display
                            renderCurrentLocationSKUCount(location);
                            
                            showToast('Lokasi berhasil disimpan!');
                        });
                    }
                    
                    // EAN input event listener for real-time search
                    if (eanField) {
                        eanField.addEventListener('input', function() {
                            // Clear previous timeout
                            clearTimeout(eanInputTimeout);
                            
                            // Show loading indicator
                            if (eanLoading) eanLoading.style.display = 'block';
                            
                            // Set timeout to delay the search
                            eanInputTimeout = setTimeout(async () => {
                                await handleLocationAndEANCheck();
                                if (eanLoading) eanLoading.style.display = 'none';
                            }, 500); // 500ms delay after typing stops
                        });
                    }
                    
                    async function handleLocationAndEANCheck() {
                        const location = locationField ? locationField.value.trim() : '';
                        const ean = eanField ? eanField.value.trim() : '';
                        
                        if (!location) {
                            showToast('Harap masukkan kode lokasi!', 'error');
                            return;
                        }
                        
                        if (!ean) {
                            // Reset fields if EAN is empty
                            if (skuField) skuField.value = '';
                            if (descriptionField) descriptionField.value = '';
                            if (traceIdField) traceIdField.value = '';
                            return;
                        }
                        
                        // Update current location display
                        await renderCurrentLocationSKUCount(location);
                        
                        try {
                            // Look up in inventory data based on location and SKU
                            currentLocationItems = await storageManager.searchInventory(location, ean);
                            
                            if (currentLocationItems.length > 0) {
                                // If found, show the first item
                                currentItemIndex = 0;
                                displayCurrentItem();
                                
                                // Hide notification if shown
                                if (notification) notification.style.display = 'none';
                                
                                // Show navigation if multiple items
                                if (navigationContainer && currentLocationItems.length > 1) {
                                    navigationContainer.style.display = 'block';
                                    updateNavigationButtons();
                                } else if (navigationContainer) {
                                    navigationContainer.style.display = 'none';
                                }
                            } else {
                                // If not found, show notification
                                if (notification) notification.style.display = 'block';
                                
                                // Clear other fields
                                if (skuField) skuField.value = '';
                                if (descriptionField) descriptionField.value = '';
                                if (traceIdField) traceIdField.value = '';
                                
                                // Hide navigation
                                if (navigationContainer) navigationContainer.style.display = 'none';
                            }
                            
                            // Check for existing count data
                            await checkExistingCountData();
                        } catch (error) {
                            console.error('Error handling location and EAN check:', error);
                            showToast('Error memeriksa data: ' + error.message, 'error');
                        }
                    }
                    
                    // Check if count data already exists for this location, EAN, and Trace ID
                    async function checkExistingCountData() {
                        const location = locationField ? locationField.value.trim() : '';
                        const ean = eanField ? eanField.value.trim() : '';
                        const traceId = traceIdField ? traceIdField.value : '';
                        const countType = countTypeField ? countTypeField.value : '';
                        
                        if (!location || !ean || !traceId) return;
                        
                        try {
                            const cycleCountData = await storageManager.getCycleCount();
                            
                            // Find existing count for this location, EAN, traceId and count type
                            const existingCount = cycleCountData.find(item => 
                                item.location === location && 
                                item.ean === ean && 
                                item.traceId === traceId && 
                                item.countType === countType
                            );
                            
                            if (existingCount && qtyField) {
                                qtyField.value = existingCount.qty;
                                qtyField.setAttribute('readonly', true);
                                if (countSavedNotification) countSavedNotification.style.display = 'block';
                            } else if (qtyField) {
                                qtyField.value = '';
                                qtyField.removeAttribute('readonly');
                                if (countSavedNotification) countSavedNotification.style.display = 'none';
                            }
                        } catch (error) {
                            console.error('Error checking existing count data:', error);
                        }
                    }
                    
                    // Display current item based on currentItemIndex
                    function displayCurrentItem() {
                        if (currentLocationItems.length === 0) return;
                        
                        const item = currentLocationItems[currentItemIndex];
                        if (skuField) skuField.value = item.sku || '';
                        if (descriptionField) descriptionField.value = item.skuDescrL || '';
                        if (traceIdField) traceIdField.value = item.traceId || '';
                        if (qtyField) qtyField.value = item.qtyOnHand || '';
                        
                        // Update navigation info
                        if (navInfo) navInfo.textContent = `Item ${currentItemIndex + 1} of ${currentLocationItems.length}`;
                        
                        // Check if count already exists for this specific item
                        checkExistingCountData();
                    }
                    
                    // Update navigation buttons state
                    function updateNavigationButtons() {
                        if (!prevBtn || !nextBtn) return;
                        
                        prevBtn.disabled = currentItemIndex === 0;
                        nextBtn.disabled = currentItemIndex === currentLocationItems.length - 1;
                    }
                    
                    // Previous button event
                    if (prevBtn) {
                        prevBtn.addEventListener('click', function() {
                            if (currentItemIndex > 0) {
                                currentItemIndex--;
                                displayCurrentItem();
                                updateNavigationButtons();
                            }
                        });
                    }
                    
                    // Next button event
                    if (nextBtn) {
                        nextBtn.addEventListener('click', function() {
                            if (currentItemIndex < currentLocationItems.length - 1) {
                                currentItemIndex++;
                                displayCurrentItem();
                                updateNavigationButtons();
                            }
                        });
                    }
                    
                    // Count type change event
                    if (countTypeField) {
                        countTypeField.addEventListener('change', function() {
                            checkExistingCountData();
                        });
                    }
                    
                    // Form submission
                    if (form) {
                        form.addEventListener('submit', async function(e) {
                            e.preventDefault();
                            
                            // Validate form
                            if (!locationField || !locationField.value) {
                                showToast('Harap masukkan lokasi!', 'error');
                                return;
                            }
                            
                            if (!eanField || !eanField.value) {
                                showToast('Harap masukkan EAN!', 'error');
                                return;
                            }
                            
                            if (!qtyField || !qtyField.value) {
                                showToast('Harap isi nilai Qty!', 'error');
                                return;
                            }
                            
                            try {
                                // Check if data exists in inventory data
                                const location = locationField.value;
                                const ean = eanField.value;
                                const traceId = traceIdField ? traceIdField.value : '';
                                const inventoryData = await storageManager.getInventory();
                                
                                const existsInInventory = inventoryData.some(item => 
                                    item.locationId === location && 
                                    item.sku === ean && 
                                    item.traceId === traceId
                                );
                                
                                if (!existsInInventory && (!remarkField || !remarkField.value)) {
                                    showToast('Data tidak ditemukan di inventory. Harap isi remark sebagai temuan.', 'error');
                                    return;
                                }
                                
                                // Check if count already exists for this type
                                const countType = countTypeField ? countTypeField.value : '';
                                const cycleCountData = await storageManager.getCycleCount();
                                
                                const existingCountIndex = cycleCountData.findIndex(item => 
                                    item.location === location && 
                                    item.ean === ean && 
                                    item.traceId === traceId && 
                                    item.countType === countType
                                );
                                
                                // Create form data object
                                const formData = {
                                    location: location,
                                    ean: ean,
                                    sku: skuField ? skuField.value : '',
                                    description: descriptionField ? descriptionField.value : '',
                                    traceId: traceId,
                                    countType: countType,
                                    qty: qtyField ? qtyField.value : '',
                                    remark: remarkField ? remarkField.value : '',
                                    timestamp: new Date().toISOString()
                                };
                                
                                // If exists, update the ID
                                if (existingCountIndex !== -1) {
                                    formData.id = cycleCountData[existingCountIndex].id;
                                }
                                
                                // Save the data
                                await storageManager.saveCycleCount(formData);
                                
                                // Show success notification
                                showToast('Data cycle count berhasil disimpan!');
                                
                                // Auto-sync to GitHub after saving if enabled
                                if (storageManager.settings.enableGitHubSync) {
                                    autoSyncToGitHub();
                                }
                                
                                // Reset form but keep location
                                const currentLocation = locationField.value;
                                form.reset();
                                locationField.value = currentLocation;
                                
                                // Clear EAN and qty fields specifically
                                if (eanField) eanField.value = '';
                                if (qtyField) qtyField.value = '';
                                
                                // Remove readonly attribute if it was set
                                if (qtyField) qtyField.removeAttribute('readonly');
                                
                                if (notification) notification.style.display = 'none';
                                if (countSavedNotification) countSavedNotification.style.display = 'none';
                                
                                // Set focus back to EAN field for next input
                                if (eanField) eanField.focus();
                                
                                // Clear current items
                                currentLocationItems = [];
                                if (navigationContainer) navigationContainer.style.display = 'none';
                                
                                // Update current location display
                                renderCurrentLocationSKUCount(currentLocation);
                            } catch (error) {
                                console.error('Error saving cycle count:', error);
                                showToast('Error menyimpan data: ' + error.message, 'error');
                            }
                        });
                    }
                    
                    // Storage status functionality
                    if (refreshStorageStatsBtn) {
                        refreshStorageStatsBtn.addEventListener('click', async function() {
                            await renderStorageStatus();
                            showToast('Status penyimpanan diperbarui');
                        });
                    }
                    
                    if (clearAllDataBtn) {
                        clearAllDataBtn.addEventListener('click', async function() {
                            if (confirm('Apakah Anda yakin ingin menghapus SEMUA data? Tindakan ini tidak dapat dibatalkan!')) {
                                try {
                                    await storageManager.clearAllData();
                                    showToast('Semua data berhasil dihapus');
                                    await renderStorageStatus();
                                    
                                    // Refresh all tables
                                    await renderDataCountTable();
                                    await renderMasterLocationData();
                                    await renderMasterEanData();
                                    await renderInventoryData();
                                } catch (error) {
                                    console.error('Error clearing all data:', error);
                                    showToast('Error menghapus data: ' + error.message, 'error');
                                }
                            }
                        });
                    }
                    
                    if (saveStorageSettingsBtn) {
                        saveStorageSettingsBtn.addEventListener('click', function() {
                            const enableIndexedDB = document.getElementById('enable-indexeddb');
                            const enableLocalStorage = document.getElementById('enable-localstorage');
                            const enableGitHubSync = document.getElementById('enable-github-sync');
                            
                            if (enableIndexedDB && enableLocalStorage && enableGitHubSync) {
                                storageManager.settings.enableIndexedDB = enableIndexedDB.checked;
                                storageManager.settings.enableLocalStorage = enableLocalStorage.checked;
                                storageManager.settings.enableGitHubSync = enableGitHubSync.checked;
                                
                                storageManager.saveSettings();
                                showToast('Pengaturan penyimpanan berhasil disimpan');
                            }
                        });
                    }
                    
                    // Initialize data tables
                    await renderMasterLocationData();
                    await renderMasterEanData();
                    await renderInventoryData();
                    await renderStorageStatus();
                    
                    // Load last sync info
                    loadLastSyncInfo();
                    
                } catch (error) {
                    console.error('Error in initApp:', error);
                    showToast('Terjadi kesalahan dalam inisialisasi aplikasi: ' + error.message, 'error');
                }
            }
        });
    </script>
    <!-- Modal untuk Tambah Data Master Location -->
<div class="modal fade" id="addMasterLocationModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tambah Data Master Location</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addMasterLocationForm">
                    <div class="mb-3">
                        <label for="addValidationCode" class="form-label">Validation Code</label>
                        <input type="text" class="form-control" id="addValidationCode" required>
                    </div>
                    <div class="mb-3">
                        <label for="addLocation" class="form-label">Location</label>
                        <input type="text" class="form-control" id="addLocation" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="saveMasterLocationBtn">Simpan</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal untuk Tambah Data Master EAN -->
<div class="modal fade" id="addMasterEanModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tambah Data Master EAN</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addMasterEanForm">
                    <div class="mb-3">
                        <label for="addEan" class="form-label">EAN</label>
                        <input type="text" class="form-control" id="addEan" required>
                    </div>
                    <div class="mb-3">
                        <label for="addSku" class="form-label">SKU</label>
                        <input type="text" class="form-control" id="addSku" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="saveMasterEanBtn">Simpan</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal untuk Tambah Data Inventory -->
<div class="modal fade" id="addInventoryModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tambah Data Inventory</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="addInventoryForm">
                    <div class="mb-3">
                        <label for="addLocationId" class="form-label">Location ID</label>
                        <input type="text" class="form-control" id="addLocationId" required>
                    </div>
                    <div class="mb-3">
                        <label for="addSkuInventory" class="form-label">SKU</label>
                        <input type="text" class="form-control" id="addSkuInventory" required>
                    </div>
                    <div class="mb-3">
                        <label for="addSkuDescrL" class="form-label">SKU Description</label>
                        <input type="text" class="form-control" id="addSkuDescrL">
                    </div>
                    <div class="mb-3">
                        <label for="addTraceId" class="form-label">Trace ID</label>
                        <input type="text" class="form-control" id="addTraceId">
                    </div>
                    <div class="mb-3">
                        <label for="addQtyOnHand" class="form-label">QTY On Hand</label>
                        <input type="number" class="form-control" id="addQtyOnHand">
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                <button type="button" class="btn btn-primary" id="saveInventoryBtn">Simpan</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
